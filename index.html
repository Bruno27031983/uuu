<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bruno's Calculator</title>

  <link rel="manifest" href="./manifest.json" />
  <!-- Ikony pre PWA a favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🧮</text></svg>">
  <link rel="apple-touch-icon" href="./icons/icon-192x192.png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.15/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

  <style>
    :root {
      --primary-bg-color: #f4f4f4;
      --secondary-bg-color: white;
      --primary-text-color: #333;
      --input-bg-color: #ffffd0;
      --input-note-bg-color: #e6faff;
      --table-header-bg-color: #f2f2f2;
      --table-border-color: #ddd;
      --current-day-bg-color: #8a2be2;
      --current-day-text-color: white;
      --btn-primary-bg: #4CAF50;
      --btn-primary-hover-bg: #388e3c;
      --btn-secondary-bg: #8a2be2;
      --btn-secondary-hover-bg: #6a1bb2;
      --btn-danger-bg: #f44336;
      --btn-danger-hover-bg: #d32f2f;
      --btn-highlight-bg: #ffcc00;
      --btn-text-color: white;
      --total-salary-bg: #e6f3ff;
      --link-color: #007bff;
      --link-hover-color: #0056b3;
      --border-radius: 5px;
      --box-shadow: 0 0 10px rgba(0,0,0,0.1);
      --font-family: Arial, sans-serif;
      --base-font-size: 16px;
      --focus-outline-color: #4CAF50;

      /* Tmavý režim */
      --dark-primary-bg-color: #333;
      --dark-secondary-bg-color: #444;
      --dark-primary-text-color: #f4f4f4;
      --dark-input-bg-color: #666;
      --dark-input-note-bg-color: #5a5a7a;
      --dark-table-header-bg-color: #666;
      --dark-table-border-color: #555;
      --dark-current-day-bg-color: #4a0e8f;
      --dark-total-salary-bg: #2c3e50;
      --dark-link-color: #6bbaff;
      --dark-link-hover-color: #8ecfff;
    }

    html {
      font-size: var(--base-font-size);
      scroll-behavior: smooth;
    }
    body {
      font-family: var(--font-family);
      line-height: 1.6;
      margin: 0;
      padding: 8px;
      background-color: var(--primary-bg-color);
      color: var(--primary-text-color);
      font-size: 0.9rem;
      transition: background-color 0.3s, color 0.3s;
    }
    .container {
      max-width: 1400px;
      margin: auto;
      background: var(--secondary-bg-color);
      padding: 15px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      position: relative;
    }
    h1 {
      text-align: center;
      font-size: 1.9rem;
      color: var(--primary-text-color);
      margin-bottom: 8px;
    }
    h2 {
      text-align: center;
      color: #555;
      margin-top: -8px;
      font-size: 0.95rem;
      font-weight: normal;
    }
    body.dark-mode h2 { color: #ccc; }

    *:focus-visible {
        outline: 2px solid var(--focus-outline-color);
        outline-offset: 2px;
        box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.3);
    }
    input:focus-visible, select:focus-visible, textarea:focus-visible, button:focus-visible {
        outline: 2px solid var(--focus-outline-color);
        outline-offset: 1px;
    }

    .settings {
      margin-bottom: 15px;
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
      gap: 5px;
    }
    .settings > div, .settings > button#toggleSettingsBtn, .settings > button.highlight {
      margin: 2px 4px;
    }
    .settings > div {
      flex: 1 1 200px;
    }
    .settings > button#toggleSettingsBtn {
      flex-basis: 100%;
      margin-bottom: 8px;
      background-color: #eee;
      color: #333;
      border: 1px solid #ccc;
      text-align: left;
      padding: 8px 12px;
      font-size: 0.9rem;
      cursor: pointer;
      border-radius: var(--border-radius);
    }
    body.dark-mode .settings > button#toggleSettingsBtn {
      background-color: #555;
      color: var(--dark-primary-text-color);
      border-color: #666;
    }
    .settings > button.highlight {
      flex: 1 1 145px;
    }
    .settings label {
      display: block;
      margin-bottom: 3px;
      font-size: 0.85rem;
      font-weight: 500;
    }
    #settings-collapsible-content {
      display: flex;
      flex-wrap: wrap;
      width: 100%;
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      transition: max-height 0.4s ease-out, opacity 0.3s ease-out, margin-top 0.4s ease-out;
      gap: 5px 8px;
    }
    #settings-collapsible-content.visible {
      max-height: 550px;
      opacity: 1;
      margin-top: 8px;
    }
    #settings-collapsible-content > div {
      flex: 1 1 200px;
      margin: 2px 0px;
    }
    .table-container {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin-bottom: 15px;
      border: 1px solid var(--table-border-color);
      border-radius: var(--border-radius);
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 8px;
      border: 1px solid var(--table-border-color);
      text-align: left;
      font-size: 0.85rem;
      vertical-align: middle;
    }
    th {
      background-color: var(--table-header-bg-color);
      font-weight: bold;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    tr.weekend-day td:first-child {
        background-color: #f9f9f9;
        font-style: italic;
    }
    body.dark-mode tr.weekend-day td:first-child {
        background-color: #3e3e3e;
    }
    td .time-input-wrapper {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    td .time-input-wrapper input[type="tel"] {
      flex-grow: 1;
      min-width: 60px;
      padding: 6px 5px;
      font-size: 0.85rem;
    }
    td .time-input-wrapper .time-btn, .copy-day-btn {
      font-size: 1rem;
      cursor: pointer;
      padding: 3px 4px;
      border: 1px solid transparent;
      border-radius: 3px;
      line-height: 1;
      background: none;
      color: #555;
      user-select: none;
      transition: background-color 0.2s, border-color 0.2s;
    }
    .copy-day-btn { font-size: 0.8em; padding: 2px 3px; margin-left: auto;}
    td .time-input-wrapper .time-btn:hover, .copy-day-btn:hover {
      background-color: #eee;
      border-color: #ccc;
    }
    body.dark-mode td .time-input-wrapper .time-btn, body.dark-mode .copy-day-btn {
      color: #bbb;
    }
    body.dark-mode td .time-input-wrapper .time-btn:hover, body.dark-mode .copy-day-btn:hover {
      background-color: #555;
      border-color: #777;
      color: #fff;
    }

    th:nth-child(1), td:nth-child(1) { width: 90px; white-space: nowrap;}
    th:nth-child(2), td:nth-child(2) { width: 105px; white-space: nowrap;}
    th:nth-child(3), td:nth-child(3) { width: 105px; white-space: nowrap;}
    th:nth-child(4), td:nth-child(4) { width: 85px; white-space: nowrap;}
    th:nth-child(5), td:nth-child(5) { width: 115px; white-space: nowrap;}
    th:nth-child(7), td:nth-child(7) { width: 95px; white-space: nowrap;}
    th:nth-child(8), td:nth-child(8) { width: 95px; white-space: nowrap;}
    th:nth-child(9), td:nth-child(9) { width: 60px; white-space: nowrap; text-align: center;}

    th:nth-child(6), td:nth-child(6) {
      min-width: 230px;
      width: 38%;
      white-space: normal;
    }

    input[type="tel"], input[type="number"], input[type="text"], select, textarea {
      width: 100%;
      padding: 7px;
      box-sizing: border-box;
      background-color: var(--input-bg-color);
      font-size: 0.85rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      vertical-align: middle;
      font-family: var(--font-family);
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    input[type="tel"]:focus, input[type="number"]:focus, input[type="text"]:focus, select:focus, textarea:focus {
        border-color: var(--focus-outline-color);
        box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
    }

    td input[type="number"] {
      min-width: 55px;
    }
    td input[type="number"][readonly] {
      background-color: #f0f0f0;
      border: none;
      padding-left: 2px;
      padding-right: 2px;
      color: #555;
    }
    textarea[id^="note-"] {
      background-color: var(--input-note-bg-color);
      resize: none;
      min-height: 34px;
      line-height: 1.4;
      overflow-y: hidden;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .result {
      font-weight: bold;
      margin-top: 15px;
      text-align: center;
    }
    .btn-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      margin-top: 20px;
      gap: 8px;
    }
    .btn {
      flex: 1 1 150px;
      padding: 10px 18px;
      color: var(--btn-text-color);
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      margin: 4px;
      transition: background-color 0.3s ease, transform 0.1s ease;
      text-align: center;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(0px); }
    .btn-primary {
      background-color: var(--btn-primary-bg);
    }
    .btn-primary:hover {
      background-color: var(--btn-primary-hover-bg);
    }
    .btn-secondary {
      background-color: var(--btn-secondary-bg);
    }
    .btn-secondary:hover {
      background-color: var(--btn-secondary-hover-bg);
    }
    .btn-danger {
      background-color: var(--btn-danger-bg);
    }
    .btn-danger:hover {
      background-color: var(--btn-danger-hover-bg);
    }
    .btn-highlight {
      background-color: var(--btn-highlight-bg);
      color: #222;
      font-weight: bold;
      box-shadow: 0 1px 8px rgba(255,204,0,0.12);
    }
    .btn-outline {
      background: transparent;
      border: 2px solid var(--btn-primary-bg);
      color: var(--btn-primary-bg);
    }
    .btn-outline:hover {
      background: var(--btn-primary-bg);
      color: var(--btn-text-color);
    }

    .sticky-header {
      position: sticky;
      top: 0;
      z-index: 20;
      background: var(--table-header-bg-color);
      border-bottom: 2px solid #8a2be2;
      box-shadow: 0 2px 10px rgba(100,100,130,0.10);
    }
    .current-day-row td {
      background-color: var(--current-day-bg-color) !important;
      color: var(--current-day-text-color) !important;
    }
    .current-day-row input,
    .current-day-row textarea {
      background-color: #e6d3ff !important;
      color: #222 !important;
    }
    .current-day-row select {
      background-color: #f7f0ff !important;
      color: #222 !important;
    }
    .holiday-row td {
      background-color: #fffbe0 !important;
      color: #b38800 !important;
      font-style: italic;
    }
    .readonly {
      background-color: #f5f5f5 !important;
      color: #888 !important;
      pointer-events: none;
    }

    .totals-row th, .totals-row td {
      background-color: var(--total-salary-bg);
      font-weight: bold;
    }
    .summary-table {
      width: 100%;
      max-width: 570px;
      margin: 12px auto 2px;
      border-collapse: collapse;
      border-radius: var(--border-radius);
      box-shadow: 0 2px 9px rgba(120,120,170,0.08);
    }
    .summary-table th, .summary-table td {
      padding: 6px 8px;
      border: 1px solid var(--table-border-color);
      text-align: left;
      font-size: 0.88rem;
    }
    .summary-table th {
      background-color: var(--table-header-bg-color);
      font-weight: 600;
    }
    .summary-table td {
      background-color: #fafdff;
    }
    .summary-table .total {
      background: #c8e6ff;
      font-weight: bold;
      font-size: 1.07em;
    }
    .summary-table .totals-label {
      font-weight: bold;
      background: #e6f3ff;
    }

    .message {
      padding: 8px 14px;
      background: #fffae5;
      border: 1px solid #eed59a;
      border-radius: var(--border-radius);
      color: #856404;
      font-size: 0.98em;
      margin: 8px 0;
    }
    .message.error {
      background: #ffe5e5;
      border-color: #f8bcbc;
      color: #b00020;
    }
    .message.success {
      background: #e6ffe6;
      border-color: #81d881;
      color: #257625;
    }

    .footer {
      margin-top: 32px;
      text-align: center;
      color: #888;
      font-size: 0.98rem;
      opacity: 0.78;
    }
    .footer a {
      color: var(--link-color);
      text-decoration: underline;
      margin-left: 2px;
      margin-right: 2px;
    }
    .footer a:hover { color: var(--link-hover-color); }
    .info-icon {
      display: inline-block;
      font-size: 1.18em;
      color: #ff9800;
      margin-left: 3px;
      cursor: pointer;
      vertical-align: middle;
    }
    .toggle-darkmode-btn {
      background: none;
      border: none;
      font-size: 1.17em;
      cursor: pointer;
      margin-left: 7px;
      color: #222;
      vertical-align: middle;
      padding: 2px 4px;
      border-radius: 3px;
      transition: background-color 0.18s;
    }
    .toggle-darkmode-btn:hover {
      background-color: #ddd;
      color: #4a0e8f;
    }
    body.dark-mode .toggle-darkmode-btn {
      color: #eee;
    }
    body.dark-mode .toggle-darkmode-btn:hover {
      background-color: #2a2a2a;
      color: #ffe066;
    }
    .tooltip {
      position: absolute;
      background: #fffbe9;
      color: #5e3600;
      padding: 7px 10px;
      border: 1px solid #f7c873;
      border-radius: 6px;
      box-shadow: 0 1px 8px rgba(150,130,60,0.08);
      font-size: 0.93em;
      max-width: 320px;
      z-index: 1000;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s;
      line-height: 1.5;
    }
    .tooltip.visible {
      opacity: 1;
    }

    /* Tmavý režim */
    body.dark-mode {
      background: var(--dark-primary-bg-color);
      color: var(--dark-primary-text-color);
    }
    body.dark-mode .container {
      background: var(--dark-secondary-bg-color);
      color: var(--dark-primary-text-color);
      box-shadow: 0 0 16px rgba(30,30,50,0.18);
    }
    body.dark-mode table,
    body.dark-mode .summary-table {
      background: #252539;
      color: var(--dark-primary-text-color);
      border-color: var(--dark-table-border-color);
    }
    body.dark-mode th,
    body.dark-mode .summary-table th {
      background: var(--dark-table-header-bg-color);
      color: #eee;
      border-color: var(--dark-table-border-color);
    }
    body.dark-mode td,
    body.dark-mode .summary-table td {
      background: #31314a;
      color: #f4f4f4;
      border-color: var(--dark-table-border-color);
    }
    body.dark-mode tr.weekend-day td:first-child {
      background-color: #242438;
    }
    body.dark-mode .readonly {
      background-color: #555 !important;
      color: #aaa !important;
    }
    body.dark-mode .totals-row th, body.dark-mode .totals-row td {
      background-color: var(--dark-total-salary-bg);
    }
    body.dark-mode .summary-table td {
      background-color: #232341;
    }
    body.dark-mode .summary-table .totals-label {
      background: #243855;
      color: #ffdf7f;
    }
    body.dark-mode .summary-table .total {
      background: #15618f;
      color: #ffe;
    }
    body.dark-mode .footer {
      color: #aaa;
    }
    body.dark-mode a {
      color: var(--dark-link-color);
    }
    body.dark-mode a:hover {
      color: var(--dark-link-hover-color);
    }
    body.dark-mode .message {
      background: #2e2e18;
      border-color: #b5a85a;
      color: #ffe066;
    }
    body.dark-mode .message.error {
      background: #541d1d;
      border-color: #bc6565;
      color: #ff9494;
    }
    body.dark-mode .message.success {
      background: #124e1b;
      border-color: #38b259;
      color: #a6ffbd;
    }
    body.dark-mode .tooltip {
      background: #272704;
      color: #ffda6e;
      border-color: #705600;
    }
    @media (max-width: 900px) {
      .container { padding: 7px; }
      .btn-container { flex-direction: column; }
      .settings { flex-direction: column; }
      .settings > div { flex-basis: 100%;}
    }
    @media (max-width: 600px) {
      .container { padding: 1px; }
      h1 { font-size: 1.15rem; }
      .table-container, table, th, td { font-size: 0.88em;}
      .settings, .btn-container, #settings-collapsible-content { flex-direction: column; }
    }
    @media print {
      body { background: white !important; color: black !important;}
      .container, .message, .settings, .footer, .btn-container, .toggle-darkmode-btn { display: none !important; }
      .table-container, table { border: none !important; }
      th, td { border: 1px solid #bbb !important; background: white !important; color: black !important;}
      .totals-row th, .totals-row td { background: #c8e6ff !important;}
      .current-day-row td { background: #e6d3ff !important; color: #222 !important;}
      .holiday-row td { background: #fffbe0 !important; color: #b38800 !important;}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Bruno's Calculator <button class="toggle-darkmode-btn" id="darkModeToggle" title="Prepni tmavý/svetlý režim">🌙</button></h1>
    <h2>Dochádzka, výpočet miezd, PDF &amp; export, zálohovanie na Firebase</h2>
    <div class="settings">
      <button id="toggleSettingsBtn" class="btn btn-outline" aria-expanded="false" aria-controls="settings-collapsible-content">Zobraziť nastavenia ▼</button>
      <div id="settings-collapsible-content">
        <div>
          <label for="employeeNameInput">Meno pracovníka:</label>
          <input type="text" id="employeeNameInput" placeholder="Zadajte meno" oninput="updateEmployeeName()" autocomplete="off">
        </div>
        <div>
          <label for="hourlyWageInput">Hodinová mzda (€):</label>
          <input type="number" id="hourlyWageInput" value="10" min="0" step="0.1" oninput="updateSettings()">
        </div>
        <div>
          <label for="taxRateInput">Daňové percento (%):</label>
          <input type="number" id="taxRateInput" value="2" min="0" step="0.1" oninput="updateSettings()">
        </div>
        <div>
          <label for="defaultBreakInput">Predvolená prestávka (hod.):</label>
          <input type="number" id="defaultBreakInput" value="0.5" min="0" step="0.1" oninput="updateSettings()">
        </div>
        <div>
          <label for="monthSelect">Mesiac:</label>
          <select id="monthSelect" onchange="changeMonth()"></select>
        </div>
        <div>
          <label for="yearSelect">Rok:</label>
          <select id="yearSelect" onchange="changeYear()"></select>
        </div>
        <div>
          <label for="decimalPlacesSelect">Počet desatinných miest:</label>
          <select id="decimalPlacesSelect" onchange="changeDecimalPlaces()">
            <option value="1">1</option>
            <option value="2" selected>2</option>
            <option value="3">3</option>
          </select>
        </div>
      </div>
      <button onclick="toggleDarkMode()" class="btn btn-highlight" id="darkModeBtn">Prepínať tmavý režim</button>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Deň</th>
            <th>Príchod</th>
            <th>Odchod</th>
            <th>Prestávka</th>
            <th>Odpracované</th>
            <th>Poznámka</th>
            <th>Hrubá Mzda (€)</th>
            <th>Čistá Mzda (€)</th>
            <th>Akcia</th>
          </tr>
        </thead>
        <tbody id="workDays">
          <!-- Tabuľka sa generuje dynamicky -->
        </tbody>
      </table>
    </div>

    <div id="totalSalary" aria-live="polite"></div>
    <div id="localStorageIndicator"></div>

    <div class="btn-container">
      <button class="btn export-btn" onclick="exportToPDF()">Exportovať do PDF</button>
      <button class="btn export-btn" onclick="sendPDF()">Odoslať PDF (s pozn.)</button>
      <button class="btn export-btn" onclick="restoreBackup()">Obnoviť zálohu z XLSX</button>
      <button class="btn backup-btn" onclick="createBackup()">Vytvoriť zálohu XLSX</button>
      <button class="btn export-btn" onclick="loadFromFirestore()">Načítať z cloudu</button>
      <button class="btn reset-btn" onclick="clearMonthData()" style="background-color: #ff9800; flex-grow: 0.5;" title="Vymazať všetky dáta pre aktuálny mesiac">Vymazať mesiac</button>
    </div>

    <div id="saveNotification" role="status" aria-live="polite">Dáta boli úspešne uložené</div>
    <div id="errorNotification" role="alert" aria-live="assertive"></div>
    <div id="warningNotification" role="alert" aria-live="assertive"></div>

    <div class="footer">
      Made by Bruno • Kód: <a href="https://github.com/brunix-sk" target="_blank" rel="noopener">GitHub</a>
    </div>
  </div>
  <script type="module">
    // Importy Firebase a ďalších knižníc sú v predchádzajúcej časti.
    // ... (Firebase config + importy sú v predchádzajúcej časti - zachovaj!)

    // -------------- Hlavný JavaScript kód aplikácie pokračuje -------------------

    // --- Utility funkcia pre korektné formátovanie času (opravujeme problém!) ---
    // Nahrádza pôvodnú "formatTimeAndMoveNext"
    function formatTimeAndMoveNext(input, nextId) {
      let value = input.value.replace(/[^\d:]/g, '');
      let numbers = value.replace(':', '');

      // Automatické pridanie dvojbodky pri zápise štyroch číslic bez dvojbodky (napr. 0642 → 06:42)
      if (/^\d{4}$/.test(numbers)) {
        value = numbers.slice(0, 2) + ':' + numbers.slice(2, 4);
      }

      // Korektné formátovanie ak je zadávané cez dvojbodku
      if (value.length === 2 && !value.includes(':')) {
        value += ':';
      } else if (value.length > 2 && value.charAt(2) !== ':' && value.indexOf(':') === -1) {
        value = value.substring(0, 2) + ':' + value.substring(2);
      }

      value = value.replace(/^:/, ''); // Odstráni ':' na začiatku
      if ((value.match(/:/g) || []).length > 1) { // Max jedna ':'
        const parts = value.split(':');
        value = parts[0] + ':' + parts.slice(1).join('');
      }
      if (value.length > 5) value = value.slice(0, 5); // Max dĺžka HH:MM

      input.value = value;

      // Posun na ďalší input po zadaní komplet času
      if (value.length === 5 && isValidTimeFormat(value)) {
        const nextElement = document.getElementById(nextId);
        if (nextElement) {
          nextElement.focus();
          if (nextElement.type !== 'number' && nextElement.select) nextElement.select();
        }
      }
    }

    // Funkcia pre validáciu času vo formáte HH:MM
    function isValidTimeFormat(timeString) {
      if (!timeString) return false;
      return /^([01]\d|2[0-3]):([0-5]\d)$/.test(timeString);
    }

    // Zvyšok kódu: všetky funkcie a eventy, ktoré už v tvojom pôvodnom kóde máš
    // (collectCurrentDataForStorage, calculateRow, debouncedSaveAndSync, createTable, updateUI, atď.)
    // Ich implementácia sa nemení, iba vyššie nahrádzaš funkciu formatTimeAndMoveNext.

    // --------- POZOR: Funkcia handleTimeInput používa túto novú funkciu ---------
    window.handleTimeInput = function(input, nextId, day) {
      formatTimeAndMoveNext(input, nextId); // Opravená funkcia!
      checkAndApplyDefaultBreak(day);
      calculateRow(day);
      debouncedSaveAndSync();
    }

    // ... pokračovanie pôvodného JS kódu aplikácie ...
    // --- Pokračovanie hlavného JavaScript kódu ---

    // Ostatné utility a UI update funkcie sú bezo zmeny (updateGreeting, updatePageTitle, ...)
    // Nižšie prikladám, čo je dôležité mať, včítane načítania dát a správy localStorage

    function getDaysInMonth(month, year) {
      return new Date(year, month + 1, 0).getDate();
    }
    function getDayName(year, month, day) {
      const DAY_NAMES_SHORT = ["Ne", "Po", "Ut", "St", "Št", "Pi", "So"];
      const date = new Date(year, month, day);
      return DAY_NAMES_SHORT[date.getDay()];
    }
    function isWeekend(year, month, day) {
      const dayOfWeek = new Date(year, month, day).getDay();
      return dayOfWeek === 0 || dayOfWeek === 6;
    }

    // ... všetky tvoje pôvodné funkcie na výpočet, zálohovanie, export, zdieľanie ...

    // Príklad: Export do PDF
    window.exportToPDF = async function() {
      const btn = event.target;
      setLoadingState(btn, true, "Exportujem PDF...");
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      try {
        doc.setFontSize(16);
        doc.text(`Výkaz práce`, 14, 22);
        // ... zvyšok exportu zostáva rovnaký ...
        showSaveNotification('PDF súbor bol úspešne vygenerovaný.');
      } catch (error) {
        showErrorNotification("Chyba pri exporte do PDF: " + error.message);
      } finally {
        setLoadingState(btn, false, "Exportovať do PDF");
      }
    }

    // Zálohovanie, obnova, výpočet súčtov atď. bežia bez zmeny

    // Inicializácia UI po načítaní stránky
    document.addEventListener('DOMContentLoaded', function() {
      initializeSettingsInputs();
    });

    // --- Tmavý režim ---
    window.toggleDarkMode = function() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }
    if (localStorage.getItem('darkMode') === 'true') {
      document.body.classList.add('dark-mode');
    }

    // --- Firebase Auth a Firestore (nechaj všetko z pôvodného) ---

    // --- Inicializácia aplikácie, eventy, onAuthStateChanged, atď. ---

    // ... komplet všetky tvoje funkcie a logika ...

  </script>
  <!-- Service Worker registrácia -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then(registration => { console.log('ServiceWorker registration successful with scope: ', registration.scope); })
          .catch(error => { console.error('ServiceWorker registration failed: ', error); });
      });
    }
  </script>
</body>
</html>
