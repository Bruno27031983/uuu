<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bruno's Calculator</title>

  <link rel="manifest" href="./manifest.json" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.15/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

  <style>
    /* --- Z√°kladn√© ≈°t√Ωly --- */
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 10px;
      background-color: #f4f4f4;
      color: #333;
    }
    .container {
      max-width: 1400px;
      margin: auto;
      background: white;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      position: relative;
    }
    h1 { /* ... bez zmien ... */ }
    h2 { /* ... bez zmien ... */ }
    .settings { /* ... bez zmien ... */ }
    .settings > div { /* ... bez zmien ... */ }
    .settings > button#toggleSettingsBtn { /* ... bez zmien ... */ }
    body.dark-mode .settings > button#toggleSettingsBtn { /* ... bez zmien ... */ }
    .settings > button.highlight { /* ... bez zmien ... */ }
    .settings label { /* ... bez zmien ... */ }
    #settings-collapsible-content { /* ... bez zmien ... */ }
    #settings-collapsible-content.visible { /* ... bez zmien ... */ }
    #settings-collapsible-content > div { /* ... bez zmien ... */ }
    .table-container { /* ... bez zmien ... */ }
    table { /* ... bez zmien ... */ }

    /* --- ≈†t√Ωly buniek a hlaviƒçky --- */
    th, td {
      padding: 8px;
      border: 1px solid #ddd;
      text-align: left;
      font-size: 0.9em;
      vertical-align: middle; /* Ponechan√© middle */
    }
    th {
      background-color: #f2f2f2;
    }

    /* --- ≈†t√Ωly pre wrapper ƒçasu --- */
    td .time-input-wrapper { /* ... bez zmien ... */ }
    td .time-input-wrapper input[type="tel"] { /* ... bez zmien ... */ }
    td .time-input-wrapper .time-btn { /* ... bez zmien ... */ }
    td .time-input-wrapper .time-btn:hover { /* ... bez zmien ... */ }
    body.dark-mode td .time-input-wrapper .time-btn { /* ... bez zmien ... */ }
    body.dark-mode td .time-input-wrapper .time-btn:hover { /* ... bez zmien ... */ }


    /* --- ≈†√≠rky stƒ∫pcov --- */
    /* 1: De≈à, 2: Pr√≠chod, 3: Odchod, 4: Prest√°vka, 5: Odpracovan√©, 6: Pozn√°mka, 7: Hrub√°, 8: ƒåist√°, 9: Akcia */
    th:nth-child(7), td:nth-child(7), /* Hrub√° Mzda */
    th:nth-child(8), td:nth-child(8) { /* ƒåist√° Mzda */ width: 14%; }
    th:nth-child(6), td:nth-child(6) { /* Pozn√°mka */ width: 20%; }
    th:nth-child(1), td:nth-child(1) { /* De≈à */ width: 7%; }
    th:nth-child(2), td:nth-child(2) { /* Pr√≠chod */ width: 10%; }
    th:nth-child(3), td:nth-child(3) { /* Odchod */ width: 10%; }
    th:nth-child(4), td:nth-child(4) { /* Prest√°vka */ width: 7%; }
    th:nth-child(5), td:nth-child(5) { /* Odpracovan√© */ width: 10%; }
    th:nth-child(9), td:nth-child(9) { /* Akcia */ width: 8%; }

    /* --- Glob√°lne ≈°t√Ωly pre input a select --- */
    input[type="tel"], input[type="number"], input[type="text"], select {
      width: 100%;
      padding: 5px;
      box-sizing: border-box;
      background-color: #ffffd0;
      font-size: 14px;
      font-family: inherit;
      border: 1px solid #ccc;
      border-radius: 3px;
      vertical-align: middle; /* Ponechan√© middle */
      /* line-height: 1.4; */ /* Odstr√°nen√© */
    }

    /* --- ≈†pecifick√Ω ≈°t√Ωl pre input pozn√°mky (NOV√ù PR√çSTUP) --- */
    td:nth-child(6) { /* Zameranie na bunku TD pozn√°mky */
       max-height: 5em; /* Obmedzenie v√Ω≈°ky samotnej bunky (cca 3 riadky) */
       overflow: hidden; /* Skrytie obsahu, ktor√Ω presahuje bunku */
       /* vertical-align: top; */ /* M√¥≈æe by≈• potrebn√©, ak `middle` sp√¥sobuje probl√©my */
    }

    input[id^="note-"] {
        background-color: #e6faff; /* ≈†pecifick√° farba */
        height: auto;      /* V√Ω≈°ka sa prisp√¥sob√≠ obsahu */
        min-height: 2.4em; /* Minim√°lna v√Ω≈°ka (cca 1 riadok + padding) */
        display: block;    /* Pre spr√°vne fungovanie v√Ω≈°ky a overflow */
        width: 100%;       /* Zaberie cel√∫ ≈°√≠rku bunky */
        overflow-y: auto;  /* SKROLLOVANIE vn√∫tri inputu */
        white-space: normal; /* Povolenie zalamovania textu */
        resize: none;      /* Inputy nemaj√∫ resize */
        /* Uisti≈• sa, ≈æe padding a border s√∫ zapoƒç√≠tan√© */
        box-sizing: border-box;
        padding: 5px;
        border: none; /* Odstr√°nime border inputu, keƒè≈æe TD m√° border */
        /* Ak je border odstr√°nen√Ω, pozadie sa m√¥≈æe dedi≈•, tak ho nastav√≠me znova */
        background-color: #e6faff;
    }
    /* Odstr√°nime padding bunky, aby input vyplnil cel√∫ v√Ω≈°ku/≈°√≠rku */
    td:nth-child(6) {
      padding: 0 !important; /* Odstr√°nenie paddingu bunky pozn√°mky */
    }
    /* A prid√°me padding sp√§≈• do inputu, ale mus√≠me zohƒæadni≈• box-sizing */
    input[id^="note-"] {
        /* ... (ostatn√© ≈°t√Ωly pre input[id^="note-"]) ... */
        padding: 5px;
        /* Border je u≈æ none */
    }


    .result { /* ... bez zmien ... */ }
    .btn-container { /* ... bez zmien ... */ }
    /* ... ostatn√© ≈°t√Ωly tlaƒçidiel ... */
    #totalSalary { /* ... bez zmien ... */ }
    #dataSizeContainer { /* Bez zmien */ }
    #dataSizeText { /* Bez zmien */ }
    #dataSizeBar { /* Bez zmien */ }
    #dataSizeFill { /* Bez zmien */ }

    /* --- Zv√Ωraznenie aktu√°lneho d≈àa --- */
    .current-day { /* ... bez zmien ... */ }
    .current-day input, .current-day select { /* ... bez zmien ... */ }
    /* ≈†t√Ωl pre input pozn√°mky v aktu√°lnom dni */
    .current-day input[id^="note-"] {
        background-color: #aa44dd !important; /* Trochu in√° farba */
        color: white !important;
        /* border: none !important; */ /* Border je u≈æ none */
    }
    /* Ak by sme chceli border v aktu√°lny de≈à */
    /* .current-day td:nth-child(6) {
        border-color: #b366ff !important;
    } */
    .current-day .time-btn { /* ... bez zmien ... */ }
    .current-day .time-btn:hover { /* ... bez zmien ... */ }

    /* --- Tmav√Ω re≈æim --- */
    body.dark-mode { /* ... bez zmien ... */ }
    body.dark-mode .container { /* ... bez zmien ... */ }
    body.dark-mode h1 { /* ... bez zmien ... */ }
    body.dark-mode table { /* ... bez zmien ... */ }
    body.dark-mode th { /* ... bez zmien ... */ }
    body.dark-mode td { /* ... bez zmien ... */ }
    body.dark-mode input[type="tel"],
    body.dark-mode input[type="number"],
    body.dark-mode input[type="text"],
    body.dark-mode select { /* Bez `textarea` */
        background-color: #666;
        color: white;
        border-color: #555;
    }
    /* Tmav√Ω re≈æim pre input pozn√°mky */
    body.dark-mode input[id^="note-"] {
        background-color: #5a5a7a !important; /* D√¥le≈æit√© na prebitie ≈°pecifickosti */
        color: white;
        border: none; /* Zded√≠ border z TD */
    }
    /* Tmav√Ω re≈æim pre bunku pozn√°mky */
    body.dark-mode td:nth-child(6) {
        background-color: #444; /* Zabezpeƒç√≠ pozadie bunky, keƒè input nem√° border */
        border-color: #555;
    }

    /* Zvy≈°ok tmav√©ho re≈æimu */
    body.dark-mode .btn { /* ... bez zmien ... */ }
    /* ... ostatn√© tmav√© ≈°t√Ωly ... */
    body.dark-mode .current-day input[id^="note-"] {
       background-color: #6c2fc7 !important;
       /* border: none !important; */
    }
    body.dark-mode .current-day td:nth-child(6) {
       background-color: #5c1db3 !important; /* Pozadie bunky v aktu√°lnom dni */
       border-color: #7e4bd7 !important; /* Border bunky v aktu√°lnom dni */
    }

    /* --- Responzivita --- */
    @media (max-width: 768px) {
        /* ... ostatn√© responz√≠vne pravidl√° ... */
        th, td { font-size: 0.8em; } /* Zachovan√© */
        input[type="tel"], input[type="number"], input[type="text"], select {
            font-size: 13px; /* Trochu men≈°ie pre konzistenciu */
        }
        input[id^="note-"] {
            font-size: 13px; /* Rovnak√© ako ostatn√© */
            min-height: 2.2em;
        }
        td:nth-child(6) { /* Bunka pozn√°mky */
           max-height: 4.5em; /* Men≈°ia maxim√°lna v√Ω≈°ka */
        }
    }
    @media (max-width: 480px) {
        /* ... ostatn√© responz√≠vne pravidl√° ... */
        th, td { font-size: 0.7em; } /* Zachovan√© */
        input[type="tel"], input[type="number"], input[type="text"], select, input[id^="note-"] { /* V≈°etky inputy */
            font-size: 12px; /* E≈°te men≈°ie */
        }
        input[id^="note-"] {
            min-height: 2em;
        }
         td:nth-child(6) { /* Bunka pozn√°mky */
           max-height: 4em; /* E≈°te men≈°ia maxim√°lna v√Ω≈°ka */
        }
    }

    /* --- Notifik√°cie --- */
    /* ... bez zmien ... */

    /* --- Prihlasovanie --- */
    /* ... bez zmien ... */
  </style>
</head>
<body>
  <div class="container">
    <div id="auth-container" style="text-align: center; margin-bottom: 20px;">
        <div id="login-form" style="display: none;"> <input type="email" id="email" placeholder="Email"> <input type="password" id="password" placeholder="Heslo"> <button class="btn export-btn" onclick="login()">Prihl√°si≈• sa</button> <button class="btn export-btn" onclick="register()">Registrova≈•</button> <a href="#" onclick="resetPassword(); return false;">Zabudli ste heslo?</a> </div> <div id="user-info" style="display: none;"> <span id="user-email"></span> <button class="btn reset-btn" onclick="logout()">Odhl√°si≈• sa</button> </div>
    </div>

    <h1 id="mainTitle">Ahoj</h1>
    <h2></h2>

    <div class="settings"> <button id="toggleSettingsBtn" class="btn">Zobrazi≈• nastavenia ‚ñº</button> <div id="settings-collapsible-content"> <div> <label for="employeeNameInput">Meno pracovn√≠ka: </label> <input type="text" id="employeeNameInput" placeholder="Zadajte meno pracovn√≠ka" oninput="updateEmployeeName()"> </div> <div> <label for="hourlyWageInput">Hodinov√° mzda (‚Ç¨): </label> <input type="number" id="hourlyWageInput" value="10" min="0" step="0.1" oninput="updateSettings()"> </div> <div> <label for="taxRateInput">Da≈àov√© percento (%): </label> <input type="number" id="taxRateInput" value="2" min="0" step="0.1" oninput="updateSettings()"> </div> <div> <label for="monthSelect">Mesiac: </label> <select id="monthSelect" onchange="changeMonth()"> <option value="0">Janu√°r</option> <option value="1">Febru√°r</option> <option value="2">Marec</option> <option value="3">Apr√≠l</option> <option value="4">M√°j</option> <option value="5">J√∫n</option> <option value="6">J√∫l</option> <option value="7">August</option> <option value="8">September</option> <option value="9">Okt√≥ber</option> <option value="10">November</option> <option value="11">December</option> </select> </div> <div> <label for="yearSelect">Rok: </label> <select id="yearSelect" onchange="changeYear()"></select> </div> <div> <label for="decimalPlacesSelect">Poƒçet desatinn√Ωch miest: </label> <select id="decimalPlacesSelect" onchange="changeDecimalPlaces()"> <option value="1">1</option> <option value="2">2</option> </select> </div> </div> <button onclick="toggleDarkMode()" class="btn highlight">Prep√≠na≈• tmav√Ω re≈æim</button> </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>De≈à</th>
            <th>Pr√≠chod</th>
            <th>Odchod</th>
            <th>Prest√°vka</th>
            <th>Odpracovan√©</th>
            <th>Pozn√°mka</th>
            <th>Hrub√° Mzda (‚Ç¨)</th>
            <th>ƒåist√° Mzda (‚Ç¨)</th>
            <th>Akcia</th>
          </tr>
        </thead>
        <tbody id="workDays">
          </tbody>
      </table>
    </div>

    <div id="totalSalary"></div>

    <div class="btn-container"> <button class="btn export-btn" onclick="exportToPDF()">Exportova≈• do PDF</button> <button class="btn export-btn" onclick="sendPDF()">Odosla≈• PDF</button> <button class="btn export-btn" onclick="restoreBackup()">Obnovi≈• z√°lohu</button> <button class="btn backup-btn" onclick="createBackup()">Vytvori≈• z√°lohu</button> <button class="btn export-btn" onclick="loadFromFirestore()">Naƒç√≠tanie z Firebase</button> </div>
  </div>

  <div id="saveNotification">D√°ta boli √∫spe≈°ne ulo≈æen√©</div>
  <div id="errorNotification"></div>

  <script type="module">
    // --- Prep√≠nanie tmav√©ho re≈æimu --- (bez zmien)
    if (localStorage.getItem('darkMode') === 'true') { document.body.classList.add('dark-mode'); }
    window.toggleDarkMode = function() { document.body.classList.toggle('dark-mode'); localStorage.setItem('darkMode', document.body.classList.contains('dark-mode')); }

    // --- IMPORTY Firebase --- (bez zmien)
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';
    import { getFirestore, collection, doc, setDoc, getDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';
    import { initializeAppCheck, ReCaptchaV3Provider } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app-check.js';

    // --- KONFIGUR√ÅCIA Firebase --- (bez zmien)
     const firebaseConfig = { /* ... va≈°a konfigur√°cia ... */ };

    // --- Inicializ√°cia Firebase --- (bez zmien)
    const app = initializeApp(firebaseConfig);
    try { /* ... App Check ... */ } catch (e) { console.warn("App Check failed:", e); }
    const auth = getAuth(app);
    const db = getFirestore(app);

    // --- GLOB√ÅLNE PREMENN√â --- (bez zmien)
    let currentUser = null;
    const workDays = document.getElementById('workDays');
    const totalSalaryDiv = document.getElementById('totalSalary');
    /* ... ostatn√© glob√°lne premenn√© ... */
    const currentDate = new Date();
    let currentMonth = currentDate.getMonth();
    let currentYear = currentDate.getFullYear();
    let decimalPlaces = parseInt(localStorage.getItem('decimalPlaces')) || 1;
    let employeeName = localStorage.getItem('employeeName') || '';
    let hourlyWage = parseFloat(localStorage.getItem('hourlyWage')) || 10;
    let taxRate = parseFloat(localStorage.getItem('taxRate')) || 0.02;

    // --- Funkcie pre UI, Auth, D√°ta, V√Ωpoƒçty, Pomocn√© --- (bez zmien oproti p√¥vodnej verzii s inputom)
    function updateGreeting() { /* ... bez zmien ... */ }
    function populateYearSelect() { /* ... bez zmien ... */ }
    /* ... Nastavenie poƒçiatoƒçn√Ωch hodn√¥t ... */
    /* ... Skr√Ωvanie nastaven√≠ ... */
    /* ... Online/Offline + Notifik√°cie ... */
    window.login = async function() { /* ... bez zmien ... */ };
    window.register = async function() { /* ... bez zmien ... */ };
    window.logout = async function() { /* ... bez zmien ... */ };
    window.resetPassword = async function() { /* ... bez zmien ... */ };
    function mapFirebaseAuthError(errorCode) { /* ... bez zmien ... */ }
    async function createUserCollection() { /* ... bez zmien ... */ }
    function updateUI() { /* ... bez zmien ... */ }
    async function loadInitialData() { /* ... bez zmien ... */ }
    async function loadFromFirestoreAndApply() { /* ... bez zmien ... */ }
    function debounce(func, wait) { /* ... bez zmien ... */ }
    const debouncedSaveToFirestore = debounce(saveToFirestore, 1000);
    function collectCurrentData() { /* ... bez zmien (pou≈æ√≠va .value) ... */ }
    async function saveToFirestore() { /* ... bez zmien ... */ }
    async function syncWithFirebase() { /* ... bez zmien ... */ }
    window.loadFromFirestore = async function() { /* ... bez zmien ... */ };
    function loadFromLocalStorageOnly() { /* ... bez zmien ... */ }
    function parseAndApplyData(dataString) { /* ... bez zmien (pou≈æ√≠va .value) ... */ }
    function getDayName(year, month, day) { /* ... bez zmien ... */ }

    // --- ZMENEN√â: createTable pou≈æ√≠va op√§≈• input type="text" ---
    function createTable() {
      console.log(`Vytv√°ram ≈°trukt√∫ru tabuƒæky pre ${getMonthName(currentMonth)} ${currentYear}`);
      workDays.innerHTML = '';
      const today = new Date();
      const currentDayOfMonth = today.getDate();
      const currentMonthIndex = today.getMonth();
      const currentYearValue = today.getFullYear();
      const daysInMonth = getDaysInMonth(currentMonth);

      for (let i = 1; i <= daysInMonth; i++) {
        const row = document.createElement('tr');
        if (i === currentDayOfMonth && currentMonth === currentMonthIndex && currentYear === currentYearValue) {
          row.classList.add('current-day');
        }

        const dayName = getDayName(currentYear, currentMonth, i);
        const startId = `start-${currentYear}-${currentMonth}-${i}`;
        const endId = `end-${currentYear}-${currentMonth}-${i}`;
        const breakId = `break-${currentYear}-${currentMonth}-${i}`;
        const noteId = `note-${currentYear}-${currentMonth}-${i}`; // Sp√§≈• na input
        const grossId = `gross-${currentYear}-${currentMonth}-${i}`;
        const netId = `net-${currentYear}-${currentMonth}-${i}`;
        const totalId = `total-${currentYear}-${currentMonth}-${i}`;

        row.innerHTML = `
          <td>${i}. ${dayName}</td>
          <td>
            <div class="time-input-wrapper">
              <input type="tel" id="${startId}" maxlength="5" pattern="[0-9:]*" inputmode="numeric" placeholder="HH:MM" oninput="handleInput(this, '${endId}')">
              <span class="time-btn" onclick="setCurrentTime('${startId}')" title="Zada≈• aktu√°lny ƒças">üïí</span>
            </div>
          </td>
          <td>
            <div class="time-input-wrapper">
              <input type="tel" id="${endId}" maxlength="5" pattern="[0-9:]*" inputmode="numeric" placeholder="HH:MM" oninput="handleInput(this, '${breakId}')">
              <span class="time-btn" onclick="setCurrentTime('${endId}')" title="Zada≈• aktu√°lny ƒças">üïí</span>
            </div>
          </td>
          <td><input type="number" id="${breakId}" min="0" step="0.5" placeholder="hod." oninput="handleBreakInput(${i})"></td>
          <td id="${totalId}">0h 0m (${(0).toFixed(decimalPlaces)} h)</td>
          <td><input type="text" id="${noteId}" placeholder="Pozn√°mka..." oninput="calculateAndUpdateTotals()"></td> {/* VR√ÅTEN√â: input type="text" */}
          <td><input type="number" id="${grossId}" min="0" step="0.01" placeholder="0.00" readonly></td>
          <td><input type="number" id="${netId}" min="0" step="0.01" placeholder="0.00" readonly></td>
          <td><button class="btn reset-btn" onclick="resetRow(${i})">X</button></td>
        `;
        workDays.appendChild(row);
      }
      console.log('≈†trukt√∫ra tabuƒæky vytvoren√°.');
    }

    // --- Ostatn√© JS funkcie --- (bez zmien oproti p√¥vodnej verzii s inputom)
    window.setCurrentTime = function(inputId) { /* ... bez zmien ... */ }
    window.handleInput = function(input, nextId) { /* ... bez zmien ... */ }
    window.handleBreakInput = function(day) { /* ... bez zmien ... */ }
    function calculateAndUpdateTotals() { /* ... bez zmien ... */ }
    function isValidTimeFormat(timeString) { /* ... bez zmien ... */ }
    function formatAndMoveNext(input, nextId) { /* ... bez zmien ... */ }
    function moveNext(currentElement, nextId) { /* ... bez zmien ... */ }
    function calculateRow(day) { /* ... bez zmien ... */ }
    function updateNetSalary(day) { /* ... bez zmien ... */ }
    window.resetRow = function(day, saveChanges = true) { /* ... bez zmien (pou≈æ√≠va .value) ... */ }
    function calculateTotal() { /* ... bez zmien ... */ }
    function getMonthName(month) { /* ... bez zmien ... */ }
    window.exportToPDF = function() { /* ... bez zmien (pou≈æ√≠va .value) ... */ }
    window.sendPDF = function() { /* ... bez zmien ... */ }
    window.changeDecimalPlaces = function() { /* ... bez zmien ... */ }
    window.updateEmployeeName = function() { /* ... bez zmien ... */ }
    window.updateSettings = function() { /* ... bez zmien ... */ }
    window.changeMonth = function() { /* ... bez zmien ... */ }
    window.changeYear = function() { /* ... bez zmien ... */ }
    function getDaysInMonth(month) { /* ... bez zmien ... */ }
    onAuthStateChanged(auth, (user) => { /* ... bez zmien ... */ });
    window.createBackup = function() { /* ... bez zmien (pou≈æ√≠va .value) ... */ };
    window.restoreBackup = function() { /* ... bez zmien (pou≈æ√≠va .value) ... */ };

  </script>

  <script>
    // --- Service Worker --- (bez zmien)
    if ('serviceWorker' in navigator) { /* ... bez zmien ... */ }
  </script>
</body>
</html>
