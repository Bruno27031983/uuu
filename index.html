<!DOCTYPE html>
<html lang="sk" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://www.gstatic.com https://apis.google.com;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com;
    img-src 'self' data: blob: https:;
    connect-src 'self' https://cdnjs.cloudflare.com https://*.firebaseio.com https://*.googleapis.com https://*.firebaseapp.com wss://*.firebaseio.com;
    frame-src 'self' https://*.firebaseapp.com https://www.google.com;
    object-src 'none';
    base-uri 'self';
    form-action 'self';
  ">
  
  <title>Bruno's Calculator Pro</title>

  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üßÆ</text></svg>">
  <meta name="theme-color" content="#7c3aed"/>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.15/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

  <style>
    :root {
      --primary-bg-color: #f0f2f5;
      --secondary-bg-color: #ffffff;
      --primary-text-color: #1f2937;
      --secondary-text-color: #4b5563;
      --input-bg-color: #fefcbf;
      --input-note-bg-color: #e0f2fe;
      --input-project-bg-color: #e0fef2;
      --table-header-bg-color: #f9fafb;
      --table-border-color: #e5e7eb;
      --current-day-bg-color: #7c3aed;
      --current-day-text-color: #ffffff;
      --btn-primary-bg: #2563eb;
      --btn-primary-hover-bg: #1d4ed8;
      --btn-secondary-bg: #7c3aed;
      --btn-secondary-hover-bg: #6d28d9;
      --btn-danger-bg: #dc2626;
      --btn-danger-hover-bg: #b91c1c;
      --btn-warning-bg: #f59e0b;
      --btn-warning-hover-bg: #d97706;
      --btn-highlight-bg: #f59e0b;
      --btn-text-color: #ffffff;
      --total-salary-bg: #eff6ff;
      --link-color: #2563eb;
      --link-hover-color: #1d4ed8;
      --border-radius: 8px;
      --box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
      --box-shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
      --font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      --base-font-size: 16px;
      --focus-outline-color: var(--btn-primary-bg);
      --transition-speed: 0.2s;
    }

    html[data-theme='dark'] {
      --primary-bg-color: #111827;
      --secondary-bg-color: #1f2937;
      --primary-text-color: #f3f4f6;
      --secondary-text-color: #9ca3af;
      --input-bg-color: #374151;
      --input-note-bg-color: #2c3a4b;
      --input-project-bg-color: #2c4b3a;
      --table-header-bg-color: #374151;
      --table-border-color: #4b5563;
      --current-day-bg-color: #8b5cf6;
      --current-day-text-color: #ffffff;
      --btn-primary-bg: #3b82f6;
      --btn-primary-hover-bg: #2563eb;
      --btn-secondary-bg: #8b5cf6;
      --btn-secondary-hover-bg: #7c3aed;
      --btn-danger-bg: #ef4444;
      --btn-danger-hover-bg: #dc2626;
      --btn-warning-bg: #f97316;
      --btn-warning-hover-bg: #ea580c;
      --btn-highlight-bg: #f97316;
      --total-salary-bg: #374151;
      --link-color: #60a5fa;
      --link-hover-color: #3b82f6;
      --focus-outline-color: var(--btn-primary-bg);
    }

    @font-face {
      font-family: 'Inter';
      src: url('https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2') format('woff2');
      font-weight: 400 700;
      font-style: normal;
      font-display: swap;
    }

    html { font-size: var(--base-font-size); scroll-behavior: smooth; }
    body {
      font-family: var(--font-family); line-height: 1.6; margin: 0; padding: 12px;
      background-color: var(--primary-bg-color); color: var(--primary-text-color);
      font-size: 0.92rem; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
      transition: background-color var(--transition-speed), color var(--transition-speed);
    }
    #app-loader {
      display: flex; justify-content: center; align-items: center; height: 100vh;
      font-size: 1.2em; color: var(--secondary-text-color); text-align: center;
      flex-direction: column; background-color: var(--primary-bg-color);
    }
    #app-loader p { margin: 5px 0; }
    #app-loader .loader-emoji { font-size: 2em; margin-bottom: 10px; }

    .container {
      max-width: 1600px; margin: 20px auto; background: var(--secondary-bg-color);
      padding: 20px; border-radius: var(--border-radius); box-shadow: var(--box-shadow-lg); position: relative;
      transition: background-color var(--transition-speed);
    }
    h1 { text-align: center; font-size: 2rem; color: var(--primary-text-color); margin-bottom: 10px; font-weight: 700; }
    h1#mainTitle {
      background: linear-gradient(45deg, #7c3aed, #db2777, #f59e0b);
      -webkit-background-clip: text; background-clip: text; color: transparent; padding-bottom: 3px;
    }
    h2 {
      text-align: center; color: var(--secondary-text-color); margin-top: -5px;
      font-size: 1rem; font-weight: 500; margin-bottom: 20px;
    }
    fieldset { border: 1px solid var(--table-border-color); border-radius: var(--border-radius); padding: 15px; margin-bottom: 20px; }
    legend { font-weight: 600; color: var(--primary-text-color); padding: 0 8px; font-size: 0.95rem; }
    
    .header-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;}
    #themeToggleBtn { font-size: 1.3rem; padding: 6px 10px; line-height: 1; background-color: var(--secondary-bg-color); color: var(--primary-text-color); border: 1px solid var(--table-border-color); cursor: pointer; }
    #themeToggleBtn:hover { background-color: var(--primary-bg-color); }

    .settings { margin-bottom: 20px; display: flex; flex-wrap: wrap; align-items: flex-start; gap: 10px; }
    .settings > div, .settings > button#toggleSettingsBtn { margin: 0; }
    .settings > div { flex: 1 1 220px; }
    .settings > button#toggleSettingsBtn {
      flex-basis: 100%; margin-bottom: 10px; background-color: var(--secondary-bg-color); color: var(--primary-text-color);
      border: 1px solid var(--table-border-color); text-align: left; padding: 10px 15px; font-size: 0.95rem;
      font-weight: 500; cursor: pointer; border-radius: var(--border-radius);
      transition: background-color var(--transition-speed), box-shadow var(--transition-speed);
    }
    .settings > button#toggleSettingsBtn:hover { background-color: var(--primary-bg-color); box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05); }
    .settings label { display: block; margin-bottom: 5px; font-size: 0.875rem; font-weight: 500; color: var(--secondary-text-color); }
    #settings-collapsible-content {
      display: flex; flex-wrap: wrap; width: 100%; max-height: 0; opacity: 0; overflow: hidden;
      transition: max-height 0.4s ease-in-out, opacity 0.3s ease-in-out, margin-top 0.4s ease-in-out; gap: 10px 12px;
    }
    #settings-collapsible-content.visible { max-height: 800px; opacity: 1; margin-top: 10px; }
    #settings-collapsible-content > fieldset { display: contents; }
    #settings-collapsible-content > fieldset > div { flex: 1 1 220px; margin: 0; }
    
    .table-container {
      overflow-x: auto; -webkit-overflow-scrolling: touch; margin-bottom: 20px;
      border: 1px solid var(--table-border-color); border-radius: var(--border-radius); box-shadow: var(--box-shadow);
    }
    table { width: 100%; border-collapse: collapse; }
    th, td {
      padding: 10px 12px; border: 1px solid var(--table-border-color); text-align: left;
      font-size: 0.875rem; vertical-align: middle; transition: background-color var(--transition-speed);
    }
    thead tr { border-bottom: 2px solid #d1d5db; }
    th { background-color: var(--table-header-bg-color); font-weight: 600; color: var(--primary-text-color); position: sticky; top: 0; z-index: 10; }
    tr.weekend-day td:first-child { background-color: #f3f4f6; font-style: normal; color: var(--secondary-text-color); }
    html[data-theme='dark'] tr.weekend-day td:first-child { background-color: #374151; color: var(--secondary-text-color); }

    td .time-input-wrapper { display: flex; align-items: center; gap: 5px; }
    td .time-input-wrapper input[type="tel"] { flex-grow: 1; min-width: 65px; padding: 8px 6px; font-size: 0.875rem; }
    td .time-input-wrapper .time-btn {
      font-size: 1.1rem; cursor: pointer; padding: 4px 5px; border: 1px solid transparent;
      border-radius: var(--border-radius); line-height: 1; background: none; color: var(--secondary-text-color);
      user-select: none; transition: background-color var(--transition-speed), border-color var(--transition-speed), color var(--transition-speed);
    }
    td .time-input-wrapper .time-btn:hover { background-color: #e5e7eb; border-color: #d1d5db; color: var(--primary-text-color); }
    html[data-theme='dark'] td .time-input-wrapper .time-btn:hover { background-color: #4b5563; border-color: #6b7280; color: var(--primary-text-color); }

    th:nth-child(1), td:nth-child(1) { width: 95px;}
    th:nth-child(2), td:nth-child(2) { width: 105px;}
    th:nth-child(3), td:nth-child(3) { width: 105px;}
    th:nth-child(4), td:nth-child(4) { width: 85px;}
    th:nth-child(5), td:nth-child(5) { width: 110px;}
    th:nth-child(6), td:nth-child(6) { min-width: 150px; width: auto; }
    th:nth-child(7), td:nth-child(7) { min-width: 200px; width: auto; }
    th:nth-child(8), td:nth-child(8) { width: 90px;}
    th:nth-child(9), td:nth-child(9) { width: 90px;}
    th:nth-child(10), td:nth-child(10) { width: 45px; text-align: center;}

    input[type="tel"], input[type="number"], input[type="text"], select, textarea {
      width: 100%; padding: 9px 12px; box-sizing: border-box; background-color: var(--input-bg-color);
      font-size: 0.9rem; border: 1px solid var(--table-border-color); border-radius: var(--border-radius); vertical-align: middle;
      font-family: var(--font-family); transition: border-color var(--transition-speed), box-shadow var(--transition-speed), background-color var(--transition-speed); color: var(--primary-text-color);
    }
    input[type="tel"]:focus, input[type="number"]:focus, input[type="text"]:focus, select:focus, textarea:focus {
        border-color: var(--focus-outline-color); box-shadow: 0 0 0 1px var(--focus-outline-color);
    }
    input[type="tel"].invalid-time, input[type="number"].invalid-value, input[type="text"].invalid-value {
        border-color: var(--btn-danger-bg) !important; box-shadow: 0 0 0 1px var(--btn-danger-bg) !important;
    }
    td input[type="number"] { min-width: 60px; }
    td input[type="text"].project-input { background-color: var(--input-project-bg-color); }
    td input[type="number"][readonly] {
      background-color: var(--table-header-bg-color) !important;
      border: none; padding-left: 2px; padding-right: 2px;
      color: var(--secondary-text-color); font-weight: 500;
    }
    textarea[id^="note-"] {
      background-color: var(--input-note-bg-color); resize: vertical; min-height: 38px; line-height: 1.5;
      overflow-y: hidden; white-space: pre-wrap; word-wrap: break-word;
    }
    .btn-container { display: flex; flex-wrap: wrap; justify-content: center; margin-top: 25px; gap: 12px; }
    .btn {
      flex: 0 1 auto; padding: 10px 20px; color: var(--btn-text-color); border: none;
      border-radius: var(--border-radius); cursor: pointer; font-size: 0.92rem; font-weight: 500;
      margin: 0; transition: background-color var(--transition-speed) ease, transform 0.1s ease, box-shadow var(--transition-speed) ease;
      text-align: center; box-shadow: var(--box-shadow);
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 7px 10px -3px rgba(0,0,0,0.1), 0 4px 5px -2px rgba(0,0,0,0.06); }
    .btn:active { transform: translateY(0px); box-shadow: var(--box-shadow); }
    .reset-btn { background-color: var(--btn-danger-bg); }
    .reset-btn:hover { background-color: var(--btn-danger-hover-bg); }
    .btn.warning-btn { background-color: var(--btn-warning-bg); color: var(--primary-text-color); }
    html[data-theme='dark'] .btn.warning-btn { color: var(--primary-bg-color); }
    .btn.warning-btn:hover { background-color: var(--btn-warning-hover-bg); }
    .export-btn { background-color: var(--btn-primary-bg); }
    .export-btn:hover { background-color: var(--btn-primary-hover-bg); }
    .backup-btn { background-color: var(--btn-secondary-bg); }
    .backup-btn:hover { background-color: var(--btn-secondary-hover-bg); }
    #totalSalary {
      font-size: 1rem; font-weight: 500; text-align: center; margin-top: 25px; padding: 15px;
      background-color: var(--total-salary-bg); border-radius: var(--border-radius); line-height: 1.8;
      color: var(--primary-text-color); box-shadow: var(--box-shadow);
      transition: background-color var(--transition-speed), color var(--transition-speed);
    }
    #totalSalary .goal-progress { font-size: 0.9em; margin-top: 8px; color: var(--secondary-text-color); }
    #totalSalary .goal-progress.good { color: #10b981; }
    #totalSalary .goal-progress.medium { color: #f59e0b; }
    #totalSalary .goal-progress.low { color: #ef4444; }
    html[data-theme='dark'] #totalSalary .goal-progress.good { color: #34d399; }
    html[data-theme='dark'] #totalSalary .goal-progress.medium { color: #f97316; }
    html[data-theme='dark'] #totalSalary .goal-progress.low { color: #f87171; }

    #localStorageIndicator { font-size: 0.8rem; text-align: right; margin-top: 8px; color: #9ca3af; }
    html[data-theme='dark'] #localStorageIndicator { color: var(--secondary-text-color); }

    .current-day { background-color: var(--current-day-bg-color) !important; color: var(--current-day-text-color); }
    .current-day td, .current-day th {
        background-color: var(--current-day-bg-color) !important; color: var(--current-day-text-color) !important;
        border-color: rgba(255,255,255,0.3) !important;
    }
    .current-day input, .current-day select, .current-day textarea, .current-day input.project-input {
      background-color: rgba(255,255,255,0.15) !important; color: var(--current-day-text-color) !important;
      border-color: rgba(255,255,255,0.4) !important;
    }
    .current-day input::placeholder, .current-day textarea::placeholder { color: rgba(255,255,255,0.7); }
    .current-day textarea[id^="note-"] { background-color: rgba(255,255,255,0.2) !important; }
    .current-day input[id^="project-"] { background-color: rgba(200,255,200,0.2) !important; }
    .current-day .time-btn { color: var(--current-day-text-color) !important; }
    .current-day .time-btn:hover { background-color: rgba(255,255,255,0.25) !important; border-color: rgba(255,255,255,0.5) !important; }

    #auth-container { margin-bottom: 20px; }
    #auth-container fieldset { width: 100%; max-width: 380px; margin-left:auto; margin-right:auto; }
    #login-form { display: flex; flex-direction: column; align-items: center; }
    #login-form input[type="email"], #login-form input[type="password"] {
      width: 100%; margin: 8px 0; display: block; padding: 10px; font-size: 0.95rem; box-sizing: border-box;
    }
    #login-form .btn {
      width: 100%; margin: 8px 0 0 0; padding: 10px 15px; font-size: 0.95rem;
      flex-grow: 0; flex-shrink: 0; flex-basis: auto; min-width: auto; max-width: none;
    }
    #login-form .btn + .btn { margin-top: 10px; }
    #login-form a { margin-top: 15px; display: block; font-size: 0.9rem; color: var(--link-color); text-decoration: none; }
    #login-form a:hover { text-decoration: underline; color: var(--link-hover-color); }
    #user-info { align-items: center; }
    
    @media (max-width: 768px) {
      body { padding: 8px; font-size: 0.9rem; }
      .container { padding: 15px; margin: 10px auto; }
      .header-controls { justify-content: center; }
      #themeToggleBtn { order: -1; }
      h1 { font-size: 1.8rem; } h2 { font-size: 0.95rem; }
      .settings { flex-direction: column; align-items: stretch; }
      .settings > div { flex-basis: auto; width: 100%; }
      #settings-collapsible-content.visible { max-height: 950px; }
      th, td { padding: 8px; font-size: 0.85rem; }
      textarea[id^="note-"] { min-height: 40px; }
      .btn-container .btn { font-size: 0.9rem; padding: 12px 18px; margin: 5px 0; min-width: 180px; max-width: 300px; }
      .btn-container .btn[title*="Vymaza≈• mesiac"] { max-width: 240px; }
    }
    
    #saveNotification, #errorNotification, #warningNotification {
        display: none; position: fixed; bottom: 25px; right: 25px; padding: 15px 22px;
        border-radius: var(--border-radius); font-size: 0.95rem; box-shadow: var(--box-shadow-lg);
        z-index: 10000; opacity: 0; transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
        transform: translateY(30px); font-weight: 500;
    }
    #saveNotification.show, #errorNotification.show, #warningNotification.show { display: block; opacity: 1; transform: translateY(0); }
    #saveNotification { background-color: var(--btn-primary-bg); color: white; }
    #errorNotification { background-color: var(--btn-danger-bg); color: white; }
    #warningNotification { background-color: var(--btn-highlight-bg); color: var(--primary-text-color); }
    html[data-theme='dark'] #warningNotification { color: var(--primary-bg-color); }

    @media print {
      html[data-theme='dark'] body { background-color: #fff !important; color: #000 !important; }
      html[data-theme='dark'] th, html[data-theme='dark'] td { background-color: #fff !important; color: #000 !important; border-color: #ccc !important; }
      #themeToggleBtn, .btn-container, #auth-container, .settings { display: none !important; }
      td input[type="text"].project-input {
          background-color: transparent !important; border: none !important; color: #000 !important;
          padding: 0 !important; text-align: left; width: auto !important; font-size: 9pt !important;
      }
    }
  </style>
</head>
<body>
  <div id="app-loader">
    <p class="loader-emoji">üßÆ</p>
    <p>Bruno's Calculator Pro+</p>
    <p style="font-size: 0.8em;">Naƒç√≠tavam aplik√°ciu...</p>
  </div>

  <div class="container" style="display: none;">
    <div id="auth-container">
      <fieldset id="login-fieldset">
        <legend>Prihl√°senie / Registr√°cia</legend>
        <div id="login-form">
          <input type="email" id="email" placeholder="Email" aria-label="Email" autocomplete="email">
          <input type="password" id="password" placeholder="Heslo" aria-label="Heslo" autocomplete="current-password">
          <button class="btn export-btn" onclick="loginUser()">Prihl√°si≈• sa</button>
          <button class="btn export-btn" onclick="registerUser()">Registrova≈•</button>
          <a href="#" onclick="resetUserPassword(); return false;">Zabudli ste heslo?</a>
        </div>
      </fieldset>
      <div class="header-controls">
        <div id="user-info" style="display: none; justify-content: flex-start; align-items: center; gap: 15px; margin-top:10px; flex-grow: 1;">
            <span id="user-email" style="font-weight:500;"></span>
            <button class="btn reset-btn" onclick="logoutUser()" style="padding: 8px 15px; font-size: 0.85rem; margin:0;">Odhl√°si≈• sa</button>
        </div>
        <button id="themeToggleBtn" onclick="toggleTheme()" class="btn" title="Prepn√∫≈• svetl√Ω/tmav√Ω re≈æim" style="margin-left: auto; background-color: var(--btn-secondary-bg); padding: 8px 12px;">
            <span id="themeIcon">üåô</span>
        </button>
      </div>
    </div>

    <h1 id="mainTitle">Vitaj üëã</h1>
    <h2 id="subTitle"></h2>

    <div class="settings">
        <button id="toggleSettingsBtn" class="btn" onclick="toggleSettings()" aria-expanded="false" aria-controls="settings-collapsible-content">Zobrazi≈• nastavenia aplik√°cie ‚ñº</button>
        <div id="settings-collapsible-content">
            <fieldset>
                <legend>Z√°kladn√© nastavenia</legend>
                <div>
                    <label for="employeeNameInput">Meno pracovn√≠ka:</label>
                    <input type="text" id="employeeNameInput" placeholder="Zadajte meno pracovn√≠ka" oninput="updateEmployeeName()">
                </div>
                <div>
                    <label for="hourlyWageInput">Hodinov√° mzda (‚Ç¨):</label>
                    <input type="text" inputmode="decimal" id="hourlyWageInput" oninput="handleNumericInput(this)" onblur="handleWageOrTaxOrGoalBlur(this)">
                </div>
                <div>
                    <label for="taxRateInput">Da≈àov√© percento (%):</label>
                    <input type="text" inputmode="decimal" id="taxRateInput" oninput="handleNumericInput(this)" onblur="handleWageOrTaxOrGoalBlur(this)">
                </div>
                <div>
                    <label for="monthlyGoalInput">Mesaƒçn√Ω cieƒæ z√°robku (‚Ç¨):</label>
                    <input type="text" inputmode="decimal" id="monthlyGoalInput" placeholder="Napr. 1500" oninput="handleNumericInput(this)" onblur="handleWageOrTaxOrGoalBlur(this)">
                </div>
                <div>
                    <label for="decimalPlacesSelect">Poƒçet desatinn√Ωch miest:</label>
                    <select id="decimalPlacesSelect" onchange="changeDecimalPlaces()">
                      <option value="1">1</option> <option value="2" selected>2</option> <option value="3">3</option>
                    </select>
                </div>
            </fieldset>
             <fieldset>
                <legend>Navig√°cia v ƒçase</legend>
                <div>
                    <label for="monthSelect">Mesiac:</label>
                    <select id="monthSelect" onchange="changeMonth()"></select>
                </div>
                <div>
                    <label for="yearSelect">Rok:</label>
                    <select id="yearSelect" onchange="changeYear()"></select>
                </div>
            </fieldset>
        </div>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>De≈à</th>
            <th>Pr√≠chod</th>
            <th>Odchod</th>
            <th>Prest√°vka</th>
            <th>Odpracovan√©</th>
            <th>Projekt/√öloha</th>
            <th>Pozn√°mka</th>
            <th>Hrub√° Mzda (‚Ç¨)</th>
            <th>ƒåist√° Mzda (‚Ç¨)</th>
            <th>Akcie</th>
          </tr>
        </thead>
        <tbody id="workDays"></tbody>
      </table>
    </div>

    <div id="totalSalary" aria-live="polite">V√Ωpoƒçet celkovej mzdy...</div>
    <div id="localStorageIndicator"></div>

    <div class="btn-container">
        <button class="btn export-btn" onclick="exportToPDF()">Exportova≈• do PDF</button>
        <button class="btn export-btn" onclick="sendPDF()">Odosla≈• PDF (s pozn.)</button>
        <button class="btn backup-btn" onclick="createBackup()">Vytvori≈• z√°lohu (XLSX)</button>
        <button class="btn backup-btn" onclick="restoreBackup()">Obnovi≈• z√°lohu (XLSX)</button>
        <button class="btn export-btn" onclick="loadFromFirestore()">Naƒç√≠ta≈• z Cloudu</button>
        <button class="btn warning-btn" onclick="clearMonthData()" title="Vymaza≈• v≈°etky d√°ta pre aktu√°lny mesiac">Vymaza≈• Mesiac</button>
    </div>
  </div>

  <div id="saveNotification" role="status" aria-live="polite">D√°ta boli √∫spe≈°ne ulo≈æen√©.</div>
  <div id="errorNotification" role="alert" aria-live="assertive">Nastala chyba.</div>
  <div id="warningNotification" role="alert" aria-live="assertive">Upozornenie.</div>

  <input type="file" id="restoreInput" style="display: none;" accept=".xlsx" onchange="handleFileRestore(this)">

  <script type="module">
    // Importy Firebase
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js';
    import {
        initializeFirestore, persistentLocalCache, CACHE_SIZE_UNLIMITED,
        collection, doc, setDoc, getDoc, updateDoc, deleteDoc, onSnapshot, writeBatch
    } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js';
    import { initializeAppCheck, ReCaptchaV3Provider } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-app-check.js';

    // POZN√ÅMKA: Pre funkƒçn√Ω Cloud mus√≠te pou≈æi≈• VA≈†E SKUTOƒåN√â kƒæ√∫ƒçe z Firebase Console.
    const firebaseConfig = {
        apiKey: "AIzaSyBdLtJlduT3iKiGLDJ0UfAakpf6wcresnk", // Placeholder
        authDomain: "uuuuu-f7ef9.firebaseapp.com",
        projectId: "uuuuu-f7ef9",
        storageBucket: "uuuuu-f7ef9.appspot.com",
        messagingSenderId: "456105865458",
        appId: "1:456105865458:web:101f0a4dcb455f174b606b",
    };
    const RECAPTCHA_V3_SITE_KEY ="6LczmP0qAAAAAACGalBT9zZekkUr3hLgA2e8o99v"; // Placeholder

    const app = initializeApp(firebaseConfig);
    
    // Inicializ√°cia AppCheck (m√¥≈æe zlyha≈• lok√°lne, preto try-catch)
    try {
       const appCheck = initializeAppCheck(app, {
           provider: new ReCaptchaV3Provider(RECAPTCHA_V3_SITE_KEY),
           isTokenAutoRefreshEnabled: true
       });
    } catch (e) {
       console.warn("App Check init warning:", e);
    }

    const auth = getAuth(app);
    let db;
    try {
        db = initializeFirestore(app, {
            localCache: persistentLocalCache({ sizeBytes: CACHE_SIZE_UNLIMITED })
        });
    } catch (error) {
        console.warn("Fallback to memory cache:", error);
        db = initializeFirestore(app, {});
    }

    // Stav aplik√°cie
    let currentUser = null;
    let workData = {}; // Kƒæ√∫ƒç: "YYYY-MM-DD", Hodnota: Object
    const currentDate = new Date();
    let currentMonth = currentDate.getMonth();
    let currentYear = currentDate.getFullYear();
    
    let appSettings = {
        decimalPlaces: 2,
        employeeName: '',
        hourlyWage: 10,
        taxRate: 20,
        monthlyEarningsGoal: null,
        theme: 'light'
    };

    const MONTH_NAMES = ["Janu√°r", "Febru√°r", "Marec", "Apr√≠l", "M√°j", "J√∫n", "J√∫l", "August", "September", "Okt√≥ber", "November", "December"];
    const UI = {};

    // Inicializ√°cia UI referenci√≠ po naƒç√≠tan√≠ DOM
    function initUI() {
        UI.workDays = document.getElementById('workDays');
        UI.totalSalary = document.getElementById('totalSalary');
        UI.mainTitle = document.getElementById('mainTitle');
        UI.subTitle = document.getElementById('subTitle');
        UI.hourlyWage = document.getElementById('hourlyWageInput');
        UI.taxRate = document.getElementById('taxRateInput');
        UI.monthlyGoal = document.getElementById('monthlyGoalInput');
        UI.monthSelect = document.getElementById('monthSelect');
        UI.yearSelect = document.getElementById('yearSelect');
        UI.decimalPlaces = document.getElementById('decimalPlacesSelect');
        UI.employeeName = document.getElementById('employeeNameInput');
        UI.settingsContent = document.getElementById('settings-collapsible-content');
        UI.settingsBtn = document.getElementById('toggleSettingsBtn');
        UI.loader = document.getElementById('app-loader');
        UI.container = document.querySelector('.container');
        UI.themeBtn = document.getElementById('themeToggleBtn');
        UI.themeIcon = document.getElementById('themeIcon');
        UI.loginForm = document.getElementById('login-form');
        UI.loginFieldset = document.getElementById('login-fieldset');
        UI.userInfo = document.getElementById('user-info');
        UI.userEmail = document.getElementById('user-email');
        
        // Naplnenie selectov
        MONTH_NAMES.forEach((m, i) => {
            const opt = document.createElement('option');
            opt.value = i;
            opt.text = m;
            if(i === currentMonth) opt.selected = true;
            UI.monthSelect.appendChild(opt);
        });

        for(let y = currentYear - 2; y <= currentYear + 2; y++) {
            const opt = document.createElement('option');
            opt.value = y;
            opt.text = y;
            if(y === currentYear) opt.selected = true;
            UI.yearSelect.appendChild(opt);
        }
    }

    // --- Core Logika ---

    function initApp() {
        initUI();
        loadSettingsFromLocal();
        loadDataFromLocal();
        applyTheme(appSettings.theme);
        
        UI.employeeName.value = appSettings.employeeName || '';
        UI.hourlyWage.value = appSettings.hourlyWage;
        UI.taxRate.value = appSettings.taxRate;
        UI.monthlyGoal.value = appSettings.monthlyEarningsGoal || '';
        UI.decimalPlaces.value = appSettings.decimalPlaces;

        renderTable();
        updateTotals();
        
        // Skrytie loadera
        UI.loader.style.display = 'none';
        UI.container.style.display = 'block';

        // Auth listener
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                UI.loginFieldset.style.display = 'none';
                UI.userInfo.style.display = 'flex';
                UI.userEmail.textContent = user.email;
                loadFromFirestore(); // Auto load po prihl√°sen√≠
            } else {
                UI.loginFieldset.style.display = 'block';
                UI.userInfo.style.display = 'none';
                UI.userEmail.textContent = '';
            }
        });
    }

    function renderTable() {
        UI.workDays.innerHTML = '';
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        UI.subTitle.textContent = `${MONTH_NAMES[currentMonth]} ${currentYear}`;

        for (let day = 1; day <= daysInMonth; day++) {
            const dateObj = new Date(currentYear, currentMonth, day);
            const dateStr = formatDateKey(dateObj);
            const dayName = dateObj.toLocaleDateString('sk-SK', { weekday: 'short' });
            const isWeekend = (dateObj.getDay() === 0 || dateObj.getDay() === 6);
            const isToday = (dateStr === formatDateKey(new Date()));

            const data = workData[dateStr] || {};
            
            const tr = document.createElement('tr');
            if (isWeekend) tr.classList.add('weekend-day');
            if (isToday) tr.classList.add('current-day');

            tr.innerHTML = `
                <td>${day}. ${dayName}</td>
                <td>
                   <div class="time-input-wrapper">
                     <input type="tel" placeholder="08:00" value="${data.start || ''}" onblur="handleTimeInput(this, '${dateStr}', 'start')">
                     <button class="time-btn" onclick="setCurrentTime(this, '${dateStr}', 'start')" title="Nastavi≈• aktu√°lny ƒças">üïí</button>
                   </div>
                </td>
                <td>
                   <div class="time-input-wrapper">
                     <input type="tel" placeholder="16:00" value="${data.end || ''}" onblur="handleTimeInput(this, '${dateStr}', 'end')">
                     <button class="time-btn" onclick="setCurrentTime(this, '${dateStr}', 'end')" title="Nastavi≈• aktu√°lny ƒças">üïí</button>
                   </div>
                </td>
                <td>
                   <input type="tel" placeholder="00:30" value="${data.break || ''}" onblur="handleTimeInput(this, '${dateStr}', 'break')">
                </td>
                <td>
                   <input type="number" readonly value="${data.worked || 0}">
                </td>
                <td>
                   <input type="text" class="project-input" placeholder="Projekt..." value="${data.project || ''}" oninput="handleTextInput(this, '${dateStr}', 'project')">
                </td>
                <td>
                   <textarea id="note-${dateStr}" placeholder="Pozn√°mka..." oninput="handleTextInput(this, '${dateStr}', 'note')">${data.note || ''}</textarea>
                </td>
                <td>
                   <input type="number" readonly value="${data.gross || 0}">
                </td>
                <td>
                   <input type="number" readonly value="${data.net || 0}">
                </td>
                <td>
                   <button class="btn reset-btn" style="padding:4px 8px; font-size:0.8rem;" onclick="clearDay('${dateStr}')">X</button>
                </td>
            `;
            UI.workDays.appendChild(tr);
        }
        updateTotals();
    }

    function calculateRow(dateStr) {
        const data = workData[dateStr];
        if (!data) return;

        const startDec = timeToDecimal(data.start);
        const endDec = timeToDecimal(data.end);
        const breakDec = timeToDecimal(data.break);

        if (startDec !== null && endDec !== null) {
            let worked = endDec - startDec - (breakDec || 0);
            if (worked < 0) worked = 0; // Ochrana proti z√°porn√Ωm ƒç√≠slam
            
            data.worked = worked.toFixed(appSettings.decimalPlaces);
            
            const wage = parseFloat(appSettings.hourlyWage) || 0;
            const tax = parseFloat(appSettings.taxRate) || 0;
            
            const gross = worked * wage;
            const net = gross * (1 - (tax / 100));

            data.gross = gross.toFixed(appSettings.decimalPlaces);
            data.net = net.toFixed(appSettings.decimalPlaces);
        } else {
            data.worked = 0;
            data.gross = 0;
            data.net = 0;
        }
        saveDataToLocal();
    }

    function updateTotals() {
        let totalWorked = 0;
        let totalGross = 0;
        let totalNet = 0;

        Object.keys(workData).forEach(key => {
            // Filtruj iba aktu√°lny mesiac/rok
            if (key.startsWith(`${currentYear}-${String(currentMonth+1).padStart(2, '0')}`)) {
                const dayData = workData[key];
                totalWorked += parseFloat(dayData.worked) || 0;
                totalGross += parseFloat(dayData.gross) || 0;
                totalNet += parseFloat(dayData.net) || 0;
            }
        });

        let goalHTML = '';
        if (appSettings.monthlyEarningsGoal && appSettings.monthlyEarningsGoal > 0) {
            const percentage = Math.min((totalNet / appSettings.monthlyEarningsGoal) * 100, 100).toFixed(1);
            let goalClass = 'low';
            if (percentage > 33) goalClass = 'medium';
            if (percentage > 75) goalClass = 'good';
            
            goalHTML = `<div class="goal-progress ${goalClass}">
                Cieƒæ: ${percentage}% splnen√Ωch (${totalNet.toFixed(2)}‚Ç¨ / ${appSettings.monthlyEarningsGoal}‚Ç¨)
            </div>`;
        }

        UI.totalSalary.innerHTML = `
            <strong>Celkovo odpracovan√©:</strong> ${formatDecimalTime(totalWorked)} hod.<br>
            <strong>Hrub√° mzda:</strong> ${totalGross.toFixed(2)} ‚Ç¨ <span style="margin:0 10px; color:#ccc">|</span>
            <strong>ƒåist√° mzda:</strong> ${totalNet.toFixed(2)} ‚Ç¨
            ${goalHTML}
        `;
    }

    // --- Pomocn√© funkcie ---

    function formatDateKey(date) {
        const y = date.getFullYear();
        const m = String(date.getMonth() + 1).padStart(2, '0');
        const d = String(date.getDate()).padStart(2, '0');
        return `${y}-${m}-${d}`;
    }

    function timeToDecimal(timeStr) {
        if (!timeStr || !timeStr.includes(':')) return null;
        const [h, m] = timeStr.split(':').map(Number);
        return h + (m / 60);
    }
    
    function formatDecimalTime(decimal) {
        const hrs = Math.floor(decimal);
        const min = Math.round((decimal - hrs) * 60);
        return `${hrs}h ${min}m`;
    }

    function showNotification(id) {
        const el = document.getElementById(id);
        el.classList.add('show');
        setTimeout(() => el.classList.remove('show'), 3000);
    }

    // --- Ukladanie / Naƒç√≠tanie ---

    function saveSettingsToLocal() {
        localStorage.setItem('brunoCalcSettings', JSON.stringify(appSettings));
    }

    function loadSettingsFromLocal() {
        const saved = localStorage.getItem('brunoCalcSettings');
        if (saved) {
            appSettings = { ...appSettings, ...JSON.parse(saved) };
        }
    }

    function saveDataToLocal() {
        localStorage.setItem('brunoCalcData', JSON.stringify(workData));
        document.getElementById('localStorageIndicator').textContent = 'Ulo≈æen√© lok√°lne';
    }

    function loadDataFromLocal() {
        const saved = localStorage.getItem('brunoCalcData');
        if (saved) {
            workData = JSON.parse(saved);
        }
    }

    // --- Event Handlers (musia by≈• v window pre inline volania) ---

    window.handleTimeInput = (input, dateStr, field) => {
        if (!workData[dateStr]) workData[dateStr] = {};
        
        // Valid√°cia ƒçasu HH:MM
        const val = input.value.trim();
        const timeRegex = /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;
        
        if (val && !timeRegex.test(val) && field !== 'break') { // Break m√¥≈æe by≈• aj ƒç√≠slo
             input.classList.add('invalid-time');
             return;
        } else {
             input.classList.remove('invalid-time');
        }

        workData[dateStr][field] = val;
        calculateRow(dateStr);
        renderTable(); // Re-render pre update read-only pol√≠
    };

    window.handleTextInput = (input, dateStr, field) => {
        if (!workData[dateStr]) workData[dateStr] = {};
        workData[dateStr][field] = input.value;
        saveDataToLocal();
    };
    
    window.handleNumericInput = (input) => {
        input.value = input.value.replace(/[^0-9.]/g, '');
    };

    window.handleWageOrTaxOrGoalBlur = (input) => {
        if (input.id === 'hourlyWageInput') appSettings.hourlyWage = parseFloat(input.value) || 0;
        if (input.id === 'taxRateInput') appSettings.taxRate = parseFloat(input.value) || 0;
        if (input.id === 'monthlyGoalInput') appSettings.monthlyEarningsGoal = parseFloat(input.value) || null;
        
        saveSettingsToLocal();
        // Prepoƒç√≠ta≈• cel√Ω mesiac s novou mzdou
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        for (let d = 1; d <= daysInMonth; d++) {
            const dateObj = new Date(currentYear, currentMonth, d);
            calculateRow(formatDateKey(dateObj));
        }
        renderTable();
    };

    window.updateEmployeeName = () => {
        appSettings.employeeName = UI.employeeName.value;
        saveSettingsToLocal();
    };

    window.changeMonth = () => {
        currentMonth = parseInt(UI.monthSelect.value);
        renderTable();
    };

    window.changeYear = () => {
        currentYear = parseInt(UI.yearSelect.value);
        renderTable();
    };
    
    window.changeDecimalPlaces = () => {
        appSettings.decimalPlaces = parseInt(UI.decimalPlaces.value);
        saveSettingsToLocal();
        renderTable();
    };

    window.toggleSettings = () => {
        const content = UI.settingsContent;
        const btn = UI.settingsBtn;
        if (content.classList.contains('visible')) {
            content.classList.remove('visible');
            btn.textContent = "Zobrazi≈• nastavenia aplik√°cie ‚ñº";
            btn.setAttribute('aria-expanded', 'false');
        } else {
            content.classList.add('visible');
            btn.textContent = "Skry≈• nastavenia aplik√°cie ‚ñ≤";
            btn.setAttribute('aria-expanded', 'true');
        }
    };

    window.setCurrentTime = (btn, dateStr, field) => {
        const now = new Date();
        const timeStr = String(now.getHours()).padStart(2,'0') + ':' + String(now.getMinutes()).padStart(2,'0');
        
        // N√°jdeme input vedƒæa tlaƒçidla
        const input = btn.previousElementSibling;
        input.value = timeStr;
        
        // Zavol√°me handler
        window.handleTimeInput(input, dateStr, field);
    };
    
    window.clearDay = (dateStr) => {
        if(confirm('Naozaj vymaza≈• z√°znam pre tento de≈à?')) {
            delete workData[dateStr];
            saveDataToLocal();
            renderTable();
        }
    };
    
    window.clearMonthData = () => {
        if(confirm(`Naozaj vymaza≈• V≈†ETKY z√°znamy pre ${MONTH_NAMES[currentMonth]} ${currentYear}?`)) {
             Object.keys(workData).forEach(key => {
                if (key.startsWith(`${currentYear}-${String(currentMonth+1).padStart(2, '0')}`)) {
                    delete workData[key];
                }
            });
            saveDataToLocal();
            renderTable();
            showNotification('saveNotification');
        }
    };

    window.toggleTheme = () => {
        const html = document.documentElement;
        const currentTheme = html.getAttribute('data-theme');
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        applyTheme(newTheme);
    };

    function applyTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        appSettings.theme = theme;
        saveSettingsToLocal();
        
        UI.themeIcon.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
        const metaThemeColor = document.querySelector('meta[name="theme-color"]');
        if(metaThemeColor) {
            metaThemeColor.setAttribute('content', theme === 'light' ? '#7c3aed' : '#1f2937');
        }
    }

    // --- Export / Import ---

    window.exportToPDF = () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        doc.setFontSize(18);
        doc.text(`V√Ωkaz pr√°ce: ${MONTH_NAMES[currentMonth]} ${currentYear}`, 14, 22);
        
        doc.setFontSize(11);
        doc.text(`Pracovn√≠k: ${appSettings.employeeName}`, 14, 30);
        doc.text(`Sadzba: ${appSettings.hourlyWage} ‚Ç¨/h`, 14, 36);

        const tableRows = [];
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

        for (let d = 1; d <= daysInMonth; d++) {
            const dateObj = new Date(currentYear, currentMonth, d);
            const key = formatDateKey(dateObj);
            const data = workData[key];

            if (data && (data.start || data.worked > 0)) {
                tableRows.push([
                    `${d}. ${dateObj.toLocaleDateString('sk-SK', {weekday: 'short'})}`,
                    data.start || '-',
                    data.end || '-',
                    data.break || '-',
                    data.worked || '0',
                    data.project || '',
                    data.gross || '0'
                ]);
            }
        }

        doc.autoTable({
            startY: 45,
            head: [['De≈à', 'Od', 'Do', 'Prest.', 'Hod.', 'Projekt', 'Hrub√° (‚Ç¨)']],
            body: tableRows,
            theme: 'grid',
            headStyles: { fillColor: [124, 58, 237] }
        });

        // P√§tiƒçka s celkovou sumou
        const finalY = doc.lastAutoTable.finalY + 10;
        const totals = UI.totalSalary.innerText.split('\n'); // Z√≠skame text z UI
        doc.text(totals[1] || '', 14, finalY); // Hrub√°/ƒåist√° mzda

        doc.save(`Vykaz_${appSettings.employeeName}_${currentMonth+1}_${currentYear}.pdf`);
    };

    window.sendPDF = () => {
        alert("Funkcia odoslania PDF vy≈æaduje backend server. PDF bolo stiahnut√©.");
        window.exportToPDF();
    };

    window.createBackup = () => {
        const wb = XLSX.utils.book_new();
        
        // Ploch√° ≈°trukt√∫ra pre Excel
        const flatData = Object.keys(workData).map(key => ({
            Datum: key,
            ...workData[key]
        }));

        const ws = XLSX.utils.json_to_sheet(flatData);
        XLSX.utils.book_append_sheet(wb, ws, "Zaloha");
        XLSX.writeFile(wb, `Backup_BrunoCalc_${formatDateKey(new Date())}.xlsx`);
    };
    
    window.restoreBackup = () => {
        document.getElementById('restoreInput').click();
    };

    window.handleFileRestore = (input) => {
        const file = input.files[0];
        if(!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(firstSheet);
            
            // Konverzia sp√§≈• do form√°tu aplik√°cie
            const restoredData = {};
            jsonData.forEach(row => {
                const { Datum, ...rest } = row;
                if(Datum) restoredData[Datum] = rest;
            });
            
            if(confirm(`N√°jden√Ωch ${Object.keys(restoredData).length} z√°znamov. Prep√≠sa≈• aktu√°lne d√°ta?`)) {
                workData = { ...workData, ...restoredData }; // Merge
                saveDataToLocal();
                renderTable();
                showNotification('saveNotification');
            }
            input.value = ''; // Reset inputu
        };
        reader.readAsArrayBuffer(file);
    };

    // --- Firebase Auth & Cloud (Zjednodu≈°en√©) ---
    
    window.loginUser = async () => {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('password').value;
        if(!email || !pass) return alert("Vypl≈àte email a heslo");
        
        UI.loader.style.display = 'flex';
        try {
            await signInWithEmailAndPassword(auth, email, pass);
            showNotification('saveNotification');
        } catch (error) {
            alert("Chyba prihl√°senia: " + error.message);
        } finally {
            UI.loader.style.display = 'none';
        }
    };

    window.registerUser = async () => {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('password').value;
        if(!email || !pass) return alert("Vypl≈àte email a heslo");

        try {
            await createUserWithEmailAndPassword(auth, email, pass);
            alert("Registr√°cia √∫spe≈°n√°!");
        } catch (error) {
            alert("Chyba registr√°cie: " + error.message);
        }
    };

    window.logoutUser = async () => {
        await signOut(auth);
        workData = {}; // Vymaza≈• d√°ta z pam√§te po odhl√°sen√≠
        loadDataFromLocal(); // Naƒç√≠ta≈• lok√°lne d√°ta (neprihl√°sen√Ω stav)
        renderTable();
    };
    
    window.resetUserPassword = async () => {
        const email = prompt("Zadajte v√°≈° email pre obnovu hesla:");
        if(email) {
            try {
                await sendPasswordResetEmail(auth, email);
                alert("Email na obnovu hesla bol odoslan√Ω.");
            } catch(e) {
                alert("Chyba: " + e.message);
            }
        }
    };

    window.loadFromFirestore = async () => {
        if (!currentUser) return;
        
        UI.loader.style.display = 'flex';
        try {
            const docRef = doc(db, "users", currentUser.uid);
            const docSnap = await getDoc(docRef);
            
            if (docSnap.exists()) {
                const cloudData = docSnap.data();
                if(cloudData.workData) workData = JSON.parse(cloudData.workData);
                if(cloudData.settings) {
                    appSettings = { ...appSettings, ...JSON.parse(cloudData.settings) };
                    saveSettingsToLocal();
                }
                saveDataToLocal();
                renderTable();
                showNotification('saveNotification');
            } else {
                console.log("No cloud data found, creating new doc...");
            }
        } catch (e) {
            console.error(e);
            showNotification('errorNotification');
        } finally {
             UI.loader.style.display = 'none';
        }
    };
    
    // Automatick√© ukladanie do Cloudu (debounce)
    let saveTimeout;
    const originalSaveLocal = saveDataToLocal;
    saveDataToLocal = function() {
        originalSaveLocal(); // Ulo≈æ lok√°lne v≈ædy
        
        if (currentUser) {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(async () => {
                try {
                    await setDoc(doc(db, "users", currentUser.uid), {
                        workData: JSON.stringify(workData),
                        settings: JSON.stringify(appSettings),
                        lastUpdated: new Date()
                    }, { merge: true });
                    document.getElementById('localStorageIndicator').textContent = 'Synchronizovan√© s Cloudom ‚úÖ';
                } catch(e) {
                    document.getElementById('localStorageIndicator').textContent = 'Chyba synchroniz√°cie ‚ö†Ô∏è';
                }
            }, 2000); // Poƒçka≈• 2 sekundy po poslednej zmene
        }
    };

    // Spusti≈• aplik√°ciu
    initApp();

  </script>
</body>
</html>
