<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bruno's Calculator</title>

  <!-- Odkaz na manifest (RELATÍVNA cesta) -->
  <link rel="manifest" href="./manifest.json" />

  <!-- Knižnice pre export do PDF a Excelu -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.15/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

  <style>
    /* Základné štýly */
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 10px;
      background-color: #f4f4f4;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      background: white;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      position: relative;
    }
    h1 {
      text-align: center;
      font-size: 2.5em;
      background: linear-gradient(90deg, #ff0000, #00ff00, #0000ff, #ffff00, #ff00ff);
      background-clip: text;
      -webkit-background-clip: text;
      color: transparent;
      animation: gradientText 5s ease-in-out infinite, textShadowPulse 2s ease-in-out infinite;
      margin-bottom: 10px;
    }
    h2 {
      text-align: center;
      color: #555;
      margin-top: -10px;
      font-size: 1.2em;
    }
    /* Live clock styling */
    #liveClock {
      text-align: center;
      font-size: 1.1em;
      margin-bottom: 15px;
      color: #0077cc;
    }
    .settings {
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
    }
    .settings > div {
      flex: 1 1 200px;
      margin: 5px;
    }
    .settings label {
      display: block;
      margin-bottom: 5px;
    }
    .table-container {
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
      min-width: 800px;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ddd;
      text-align: left;
      font-size: 0.9em;
    }
    th {
      background-color: #f2f2f2;
    }
    input[type="time"],
    input[type="number"],
    input[type="text"] {
      width: 100%;
      padding: 5px;
      box-sizing: border-box;
      background-color: #ffffd0;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 3px;
    }
    .result {
      font-weight: bold;
      margin-top: 20px;
      text-align: center;
    }
    .btn-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      margin-top: 20px;
    }
    .btn {
      flex: 1 1 150px;
      padding: 10px 20px;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
      transition: background-color 0.3s ease;
    }
    .reset-btn {
      background-color: #f44336;
    }
    .reset-btn:hover {
      background-color: #d32f2f;
    }
    .export-btn {
      background-color: #4CAF50;
    }
    .export-btn:hover {
      background-color: #388e3c;
    }
    .backup-btn {
      background-color: #8a2be2;
      padding: 15px 20px;
    }
    .backup-btn:hover {
      background-color: #6a1bb2;
    }
    .highlight {
      background-color: #ffcc00;
      color: #333;
      font-weight: bold;
      border: 2px solid #ffcc00;
    }
    #totalSalary {
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      margin-top: 20px;
      padding: 10px;
      background-color: #e6f3ff;
      border-radius: 5px;
    }
    #dataSizeContainer {
      margin-top: 10px;
      text-align: center;
    }
    #dataSizeText {
      margin-bottom: 5px;
      font-size: 14px;
      color: #555;
    }
    #dataSizeBar {
      width: 80%;
      height: 20px;
      background-color: #ddd;
      border-radius: 10px;
      margin: 0 auto;
      overflow: hidden;
    }
    #dataSizeFill {
      height: 100%;
      width: 0%;
      background-color: #4CAF50;
      transition: width 0.3s ease;
    }
    .current-day {
      background-color: #8a2be2;
      color: white;
    }
    .current-day input {
      background-color: #9932cc;
      color: white;
    }
    /* Tmavý režim */
    body.dark-mode {
      background-color: #333;
      color: #f4f4f4;
    }
    body.dark-mode .container {
      background-color: #444;
      color: #f4f4f4;
    }
    body.dark-mode table {
      background-color: #555;
      color: #f4f4f4;
    }
    body.dark-mode th {
      background-color: #666;
    }
    body.dark-mode td {
      background-color: #444;
      color: #f4f4f4;
    }
    body.dark-mode input[type="time"],
    body.dark-mode input[type="number"],
    body.dark-mode input[type="text"] {
      background-color: #666;
      color: white;
    }
    body.dark-mode .btn {
      color: #333;
    }
    body.dark-mode .reset-btn {
      background-color: #d32f2f;
    }
    body.dark-mode .export-btn {
      background-color: #388e3c;
    }
    body.dark-mode .backup-btn {
      background-color: #6a1bb2;
    }
    body.dark-mode #totalSalary {
      background-color: #2c3e50;
    }
    body.dark-mode .current-day {
      background-color: #4a0e8f;
      color: #fff;
    }
    body.dark-mode .current-day input {
      background-color: #5c1db3;
      color: #fff;
    }
    @keyframes gradientText {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    @keyframes textShadowPulse {
      0%, 100% {
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.5),
                     0 0 20px rgba(255, 255, 255, 0.3),
                     0 0 30px rgba(255, 255, 255, 0.2);
      }
      50% {
        text-shadow: 0 0 20px rgba(255, 255, 255, 1),
                     0 0 30px rgba(255, 255, 255, 0.9),
                     0 0 40px rgba(255, 255, 255, 0.7);
      }
    }
    @media (max-width: 768px) {
      body { padding: 5px; }
      .container { padding: 10px; }
      h1 { font-size: 1.8em; }
      h2 { font-size: 1em; }
      .settings { flex-direction: column; align-items: stretch; }
      .settings > div { flex: 1 1 auto; margin: 10px 0; }
      table { min-width: 800px; }
      th, td { padding: 6px; font-size: 0.8em; }
      .btn-container { flex-direction: column; align-items: stretch; }
      .btn { flex: 1 1 auto; font-size: 14px; padding: 8px 16px; margin: 5px 0; }
      .backup-btn { padding: 15px 16px; }
      #totalSalary { font-size: 16px; }
      #dataSizeContainer { font-size: 12px; }
      .table-container { overflow-x: auto; }
    }
    @media (max-width: 480px) {
      h1 { font-size: 1.5em; }
      th, td { font-size: 0.7em; }
      .btn { font-size: 12px; padding: 6px 12px; }
      .backup-btn { padding: 15px 12px; }
      .settings label { font-size: 0.9em; }
      input[type="time"], input[type="number"], input[type="text"] { font-size: 12px; }
      table { min-width: 800px; }
    }
    /* Notifikácie */
    #saveNotification, #errorNotification {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 10px 20px;
      border-radius: 5px;
      font-size: 14px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }
    #saveNotification.show, #errorNotification.show {
      display: block;
      opacity: 1;
    }
    #saveNotification { background-color: #4CAF50; color: white; }
    #errorNotification { background-color: #f44336; color: white; }
    /* Spinner pre synchronizáciu */
    #syncSpinner {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1500;
    }
    #syncSpinner div {
      width: 40px;
      height: 40px;
      border: 5px solid #ccc;
      border-top: 5px solid #0077cc;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="container">
    <!-- Autentifikačné UI -->
    <div id="auth-container" style="text-align: center; margin-bottom: 20px;">
      <div id="login-form" style="display: none;">
        <input type="email" id="email" placeholder="Email" aria-label="Email">
        <input type="password" id="password" placeholder="Heslo" aria-label="Heslo">
        <button class="btn export-btn" onclick="login()">Prihlásiť sa</button>
        <button class="btn export-btn" onclick="register()">Registrovať</button>
      </div>
      <div id="user-info" style="display: none;">
        <span id="user-email"></span>
        <button class="btn reset-btn" onclick="logout()">Odhlásiť sa</button>
      </div>
    </div>

    <!-- Živý čas -->
    <div id="liveClock" aria-live="polite">Aktuálny čas: --:--:--</div>

    <h1 id="mainTitle">Bruno's Calculator</h1>
    <h2></h2>

    <!-- Nastavenia -->
    <div class="settings">
      <div>
        <label for="employeeNameInput">Meno pracovníka:</label>
        <input type="text" id="employeeNameInput" placeholder="Zadajte meno pracovníka" oninput="updateEmployeeName()" aria-label="Meno pracovníka" tabindex="0">
      </div>
      <div>
        <label for="hourlyWageInput">Hodinová mzda (€):</label>
        <input type="number" id="hourlyWageInput" value="10" min="0" step="0.1" oninput="updateSettings()" aria-label="Hodinová mzda" tabindex="0">
      </div>
      <div>
        <label for="taxRateInput">Daňové percento (%):</label>
        <input type="number" id="taxRateInput" value="2" min="0" step="0.1" oninput="updateSettings()" aria-label="Daňové percento" tabindex="0">
      </div>
      <div>
        <label for="monthSelect">Mesiac:</label>
        <select id="monthSelect" onchange="changeMonth()" aria-label="Výber mesiaca" tabindex="0">
          <option value="0">Január</option>
          <option value="1">Február</option>
          <option value="2">Marec</option>
          <option value="3">Apríl</option>
          <option value="4">Máj</option>
          <option value="5">Jún</option>
          <option value="6">Júl</option>
          <option value="7">August</option>
          <option value="8">September</option>
          <option value="9">Október</option>
          <option value="10">November</option>
          <option value="11">December</option>
        </select>
      </div>
      <div>
        <label for="yearSelect">Rok:</label>
        <select id="yearSelect" onchange="changeYear()" aria-label="Výber roka" tabindex="0">
          <!-- Dynamicky generované roky -->
        </select>
      </div>
      <div>
        <label for="decimalPlacesSelect">Počet desatinných miest:</label>
        <select id="decimalPlacesSelect" onchange="changeDecimalPlaces()" aria-label="Desatinné miesta" tabindex="0">
          <option value="1">1</option>
          <option value="2">2</option>
        </select>
      </div>
      <button onclick="toggleDarkMode()" class="btn highlight" tabindex="0">Prepínať tmavý režim</button>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Deň</th>
            <th>Príchod</th>
            <th>Odchod</th>
            <th>Prestávka</th>
            <th>Odpracované</th>
            <th>Hrubá Mzda (€)</th>
            <th>Čistá Mzda (€)</th>
            <th>Akcia</th>
          </tr>
        </thead>
        <tbody id="workDays">
          <!-- Riadky budú generované cez JavaScript -->
        </tbody>
      </table>
    </div>

    <div id="totalSalary"></div>

    <div class="btn-container">
      <button class="btn export-btn" onclick="exportToPDF()" tabindex="0">Exportovať do PDF</button>
      <button class="btn export-btn" onclick="sendPDF()" tabindex="0">Odoslať PDF</button>
      <button class="btn export-btn" onclick="restoreBackup()" tabindex="0">Obnoviť zálohu</button>
      <button class="btn backup-btn" onclick="createBackup()" tabindex="0">Vytvoriť zálohu</button>
      <button class="btn export-btn" onclick="loadFromFirestore()" tabindex="0">Načítanie z Firebase</button>
    </div>
  </div>

  <!-- Spinner pre synchronizáciu -->
  <div id="syncSpinner"><div></div></div>

  <div id="saveNotification">Dáta boli úspešne uložené</div>
  <div id="errorNotification"></div>

  <!-- Hlavný JavaScript kód + Firebase -->
  <script type="module">
    // Aktualizácia živého času
    function updateLiveClock() {
      const clock = document.getElementById('liveClock');
      const now = new Date();
      clock.textContent = 'Aktuálny čas: ' + now.toLocaleTimeString();
    }
    setInterval(updateLiveClock, 1000);
    updateLiveClock();

    // Načítanie preferencie tmavého režimu z localStorage
    if (localStorage.getItem('darkMode') === 'true') {
      document.body.classList.add('dark-mode');
    }
    window.toggleDarkMode = function() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }

    // ----------------------- IMPORTY Firebase -----------------------
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';
    import { getFirestore, collection, doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';
    import { initializeAppCheck, ReCaptchaV3Provider } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app-check.js';

    // ---------------------- KONFIGURÁCIA Firebase --------------------
    const firebaseConfig = {
      apiKey: "AIzaSyBdLtJlduT3iKiGLDJ0UfAakpf6wcresnk",
      authDomain: "uuuuu-f7ef9.firebaseapp.com",
      projectId: "uuuuu-f7ef9",
      storageBucket: "uuuuu-f7ef9.firebasestorage.app",
      messagingSenderId: "456105865458",
      appId: "1:456105865458:web:101f0a4dcb455f174b606b",
    };
    const app = initializeApp(firebaseConfig);
    const appCheck = initializeAppCheck(app, {
      provider: new ReCaptchaV3Provider('6LczmP0qAAAAAACGalBT9zZekkUr3hLgA2e8o99v'),
      isTokenAutoRefreshEnabled: true
    });
    const auth = getAuth(app);
    const db = getFirestore(app);

    // -------------------- GLOBÁLNE PREMENNÉ --------------------
    let currentUser = null;
    const workDays = document.getElementById('workDays');
    const totalSalaryDiv = document.getElementById('totalSalary');
    const mainTitle = document.getElementById('mainTitle');
    const hourlyWageInput = document.getElementById('hourlyWageInput');
    const taxRateInput = document.getElementById('taxRateInput');
    const monthSelect = document.getElementById('monthSelect');
    const yearSelect = document.getElementById('yearSelect');
    const decimalPlacesSelect = document.getElementById('decimalPlacesSelect');
    const employeeNameInput = document.getElementById('employeeNameInput');
    const syncSpinner = document.getElementById('syncSpinner');

    const currentDate = new Date();
    let currentMonth = currentDate.getMonth();
    let currentYear = currentDate.getFullYear();
    let decimalPlaces = parseInt(localStorage.getItem('decimalPlaces')) || 1;
    let employeeName = localStorage.getItem('employeeName') || '';
    let hourlyWage = parseFloat(hourlyWageInput.value);
    let taxRate = parseFloat(taxRateInput.value) / 100;
    let monthData = {};

    // -------------------- GENEROVANIE ROKOV --------------------
    function populateYearSelect() {
      const startYear = 2020, endYear = 2030;
      for (let year = startYear; year <= endYear; year++) {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year;
        yearSelect.appendChild(option);
      }
      yearSelect.value = currentYear;
    }
    populateYearSelect();
    monthSelect.value = currentMonth;
    yearSelect.value = currentYear;
    decimalPlacesSelect.value = decimalPlaces;
    employeeNameInput.value = employeeName;

    // -------------------- ONLINE/OFFLINE MONITORING --------------------
    function isOnline() { return navigator.onLine; }
    window.addEventListener('online', () => {
      showStatusNotification('Online', 'green');
      syncWithFirebase();
    });
    window.addEventListener('offline', () => {
      showStatusNotification('Offline', 'red');
    });
    function showStatusNotification(message, color) {
      const notification = document.createElement('div');
      notification.textContent = message;
      notification.style.position = 'fixed';
      notification.style.top = '20px';
      notification.style.right = '20px';
      notification.style.padding = '10px 20px';
      notification.style.borderRadius = '5px';
      notification.style.backgroundColor = color;
      notification.style.color = 'white';
      notification.style.zIndex = '1000';
      document.body.appendChild(notification);
      setTimeout(() => { notification.remove(); }, 3000);
    }
    function showErrorNotification(message) {
      const notification = document.getElementById('errorNotification');
      notification.textContent = message;
      notification.classList.add('show');
      setTimeout(() => { notification.classList.remove('show'); }, 3000);
    }
    function showSaveNotification(message = 'Dáta boli úspešne uložené') {
      const notification = document.getElementById('saveNotification');
      notification.textContent = message;
      notification.classList.add('show');
      setTimeout(() => { notification.classList.remove('show'); }, 2000);
    }
    function showSyncSpinner(show) {
      syncSpinner.style.display = show ? 'block' : 'none';
    }

    // -------------------- AUTENTIFIKÁCIA --------------------
    window.login = async function() {
      if (!isOnline()) { showErrorNotification('Ste offline. Prihlásenie je možné iba online.'); return; }
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        currentUser = userCredential.user;
        updateUI();
      } catch (error) {
        showErrorNotification('Chyba pri prihlásení: ' + error.message);
      }
    }
    window.register = async function() {
      if (!isOnline()) { showErrorNotification('Ste offline. Registrácia je možná iba online.'); return; }
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        currentUser = userCredential.user;
        await createUserCollection();
        updateUI();
      } catch (error) {
        showErrorNotification('Chyba pri registrácii: ' + error.message);
      }
    }
    window.logout = async function() {
      try {
        await signOut(auth);
        currentUser = null;
        updateUI();
        monthData = {};
      } catch (error) {
        showErrorNotification('Chyba pri odhlásení: ' + error.message);
      }
    }
    async function createUserCollection() {
      if (currentUser) {
        const userRef = doc(db, 'users', currentUser.uid);
        await setDoc(userRef, { email: currentUser.email, createdAt: new Date() }, { merge: true });
        const initialDocRef = doc(collection(userRef, 'workDays'), 'initial');
        await setDoc(initialDocRef, { created: true });
      }
    }

    // -------------------- UI UPDATE A NAČÍTANIE DÁT --------------------
    function updateUI() {
      const loginForm = document.getElementById('login-form');
      const userInfo = document.getElementById('user-info');
      const userEmail = document.getElementById('user-email');
      createTable();
      if (currentUser) {
        loginForm.style.display = 'none';
        userInfo.style.display = 'block';
        userEmail.textContent = currentUser.email;
        loadInitialData();
      } else {
        loginForm.style.display = 'block';
        userInfo.style.display = 'none';
        loadFromLocalStorageOnly();
        if (!isOnline()) showErrorNotification('Ste offline. Prihláste sa pre prístup k cloudovým dátam.');
      }
    }
    async function loadInitialData() {
      const localKey = `workData-${currentYear}-${currentMonth}`;
      const localData = localStorage.getItem(localKey);
      if (localData) {
        parseAndApplyData(localData);
        if (isOnline()) { syncWithFirebase(); }
      } else if (isOnline() && currentUser) {
        try {
          const userRef = doc(db, 'users', currentUser.uid);
          const docRef = doc(userRef, 'workDays', `${currentYear}-${currentMonth}`);
          const docSnap = await getDoc(docRef);
          if (docSnap.exists()) {
            const storedData = docSnap.data();
            const dataString = JSON.stringify(storedData);
            localStorage.setItem(localKey, dataString);
            parseAndApplyData(dataString);
          } else {
            console.log('Žiadne údaje v Firestore pre tento mesiac.');
          }
        } catch (error) {
          showErrorNotification('Chyba pri načítavaní dát z Firebase: ' + error.message);
        }
      } else {
        calculateTotal();
      }
    }
    function loadFromLocalStorageOnly() {
      const localKey = `workData-${currentYear}-${currentMonth}`;
      const localData = localStorage.getItem(localKey);
      if (localData) { parseAndApplyData(localData); }
      else { calculateTotal(); }
    }
    function parseAndApplyData(dataString) {
      try {
        const storedData = JSON.parse(dataString);
        monthData[currentYear] = monthData[currentYear] || {};
        monthData[currentYear][currentMonth] = storedData.data;
        hourlyWage = storedData.hourlyWage || parseFloat(hourlyWageInput.value);
        taxRate = storedData.taxRate || parseFloat(taxRateInput.value) / 100;
        employeeName = storedData.employeeName || '';
        decimalPlaces = storedData.decimalPlaces || 1;
        hourlyWageInput.value = hourlyWage;
        taxRateInput.value = (taxRate * 100).toFixed(1);
        employeeNameInput.value = employeeName;
        decimalPlacesSelect.value = decimalPlaces;
        storedData.data.forEach((day, index) => {
          const i = index + 1;
          const startElement = document.getElementById(`start-${currentYear}-${currentMonth}-${i}`);
          const endElement = document.getElementById(`end-${currentYear}-${currentMonth}-${i}`);
          const breakElement = document.getElementById(`break-${currentYear}-${currentMonth}-${i}`);
          if (startElement && endElement && breakElement) {
            startElement.value = day.start || '';
            endElement.value = day.end || '';
            breakElement.value = day.breakTime || '';
            calculateRow(i);
          }
        });
        calculateTotal();
      } catch (error) {
        showErrorNotification('Chyba pri spracovaní uložených dát: ' + error.message);
        calculateTotal();
      }
    }
    // -------------------- Tvorba tabuľky a výpočty --------------------
    function getDayName(year, month, day) {
      const daysOfWeek = ["Nedeľa", "Pondelok", "Utorok", "Streda", "Štvrtok", "Piatok", "Sobota"];
      const date = new Date(year, month, day);
      return daysOfWeek[date.getDay()];
    }
    function createTable() {
      workDays.innerHTML = '';
      const currentDayOfMonth = new Date().getDate();
      const currentMonthIndex = new Date().getMonth();
      const currentYearValue = new Date().getFullYear();
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      for (let i = 1; i <= daysInMonth; i++) {
        const row = document.createElement('tr');
        if (i === currentDayOfMonth && currentMonth === currentMonthIndex && currentYear === currentYearValue) {
          row.classList.add('current-day');
        }
        const dayName = getDayName(currentYear, currentMonth, i);
        row.innerHTML = `
          <td>Deň ${i} (${dayName})</td>
          <td><input type="time" id="start-${currentYear}-${currentMonth}-${i}" aria-label="Čas príchodu dňa ${i}" tabindex="0" oninput="handleInput(this, 'end-${currentYear}-${currentMonth}-${i}')"></td>
          <td><input type="time" id="end-${currentYear}-${currentMonth}-${i}" aria-label="Čas odchodu dňa ${i}" tabindex="0" oninput="handleInput(this, 'break-${currentYear}-${currentMonth}-${i}')"></td>
          <td><input type="number" id="break-${currentYear}-${currentMonth}-${i}" min="0" step="0.5" placeholder="Prestávka" aria-label="Prestávka dňa ${i}" tabindex="0" oninput="handleBreakInput(${i})"></td>
          <td id="total-${currentYear}-${currentMonth}-${i}">0h 0m (${(0).toFixed(decimalPlaces)} h)</td>
          <td><input type="number" id="gross-${currentYear}-${currentMonth}-${i}" min="0" step="0.01" placeholder="Hrubá Mzda" readonly></td>
          <td><input type="number" id="net-${currentYear}-${currentMonth}-${i}" min="0" step="0.01" placeholder="Čistá Mzda" readonly></td>
          <td><button class="btn reset-btn" onclick="resetRow(${i})" tabindex="0">Vynulovať</button></td>
        `;
        workDays.appendChild(row);
      }
    }
    window.handleInput = function(input, nextId) {
      // Automatické spracovanie vstupu
      if (input.value.length === 5) {
        const day = parseInt(input.id.split('-')[3]);
        calculateRow(day);
        moveNext(input, nextId);
      }
      calculateAndUpdateTotals();
    }
    window.handleBreakInput = function(day) {
      calculateRow(day);
      calculateAndUpdateTotals();
    }
    function moveNext(currentElement, nextId) {
      const nextElement = document.getElementById(nextId);
      if (nextElement) { nextElement.focus(); }
    }
    function calculateRow(day) {
      const startTimeInput = document.getElementById(`start-${currentYear}-${currentMonth}-${day}`);
      const endTimeInput = document.getElementById(`end-${currentYear}-${currentMonth}-${day}`);
      const breakTimeInput = document.getElementById(`break-${currentYear}-${currentMonth}-${day}`);
      const totalCell = document.getElementById(`total-${currentYear}-${currentMonth}-${day}`);
      const grossInput = document.getElementById(`gross-${currentYear}-${currentMonth}-${day}`);
      const netInput = document.getElementById(`net-${currentYear}-${currentMonth}-${day}`);
      if (!startTimeInput || !endTimeInput || !breakTimeInput || !totalCell || !grossInput || !netInput) return;
      const startTime = startTimeInput.value;
      const endTime = endTimeInput.value;
      const breakTime = parseFloat(breakTimeInput.value) || 0;
      if (!startTime || !endTime) {
        totalCell.textContent = `0h 0m (${(0).toFixed(decimalPlaces)} h)`;
        grossInput.value = (0).toFixed(decimalPlaces);
        netInput.value = (0).toFixed(decimalPlaces);
        return;
      }
      const [startHours, startMinutes] = startTime.split(':').map(Number);
      const [endHours, endMinutes] = endTime.split(':').map(Number);
      const startDate = new Date(2000, 0, 1, startHours, startMinutes);
      const endDate = new Date(2000, 0, 1, endHours, endMinutes);
      let diffMillis = endDate - startDate;
      if (diffMillis < 0) diffMillis += 24 * 60 * 60 * 1000;
      let diffMinutes = diffMillis / 60000 - (breakTime * 60);
      if (diffMinutes < 0) diffMinutes = 0;
      const totalMinutesRounded = Math.round(diffMinutes);
      const hours = Math.floor(totalMinutesRounded / 60);
      const minutes = totalMinutesRounded % 60;
      const decimalHours = diffMinutes / 60;
      totalCell.textContent = `${hours}h ${minutes}m (${decimalHours.toFixed(decimalPlaces)} h)`;
      const grossSalary = decimalHours * hourlyWage;
      grossInput.value = Math.max(0, grossSalary).toFixed(decimalPlaces);
      updateNetSalary(day);
    }
    function updateNetSalary(day) {
      const grossSalaryInput = document.getElementById(`gross-${currentYear}-${currentMonth}-${day}`);
      const netSalaryInput = document.getElementById(`net-${currentYear}-${currentMonth}-${day}`);
      if (!grossSalaryInput || !netSalaryInput) return;
      const grossSalary = parseFloat(grossSalaryInput.value) || 0;
      const netSalary = grossSalary * (1 - taxRate);
      netSalaryInput.value = Math.max(0, netSalary).toFixed(decimalPlaces);
    }
    window.resetRow = function(day) {
      document.getElementById(`start-${currentYear}-${currentMonth}-${day}`).value = '';
      document.getElementById(`end-${currentYear}-${currentMonth}-${day}`).value = '';
      document.getElementById(`break-${currentYear}-${currentMonth}-${day}`).value = '';
      calculateRow(day);
      calculateAndUpdateTotals();
    }
    function calculateTotal() {
      let totalMinutesPrecise = 0, totalGrossSalaryPrecise = 0, totalNetSalaryPrecise = 0, daysWithEntries = 0;
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      for (let i = 1; i <= daysInMonth; i++) {
        const startInput = document.getElementById(`start-${currentYear}-${currentMonth}-${i}`);
        const endInput = document.getElementById(`end-${currentYear}-${currentMonth}-${i}`);
        const breakInput = document.getElementById(`break-${currentYear}-${currentMonth}-${i}`);
        if (!startInput || !endInput || !breakInput) continue;
        const startTime = startInput.value;
        const endTime = endInput.value;
        const breakTime = parseFloat(breakInput.value) || 0;
        let dayMinutes = 0, dayGrossSalary = 0, dayNetSalary = 0, hasEntry = false;
        if (startTime && endTime) {
          const [startHours, startMinutes] = startTime.split(':').map(Number);
          const [endHours, endMinutes] = endTime.split(':').map(Number);
          const startDate = new Date(2000, 0, 1, startHours, startMinutes);
          const endDate = new Date(2000, 0, 1, endHours, endMinutes);
          let diffMillis = endDate - startDate;
          if (diffMillis < 0) diffMillis += 24 * 60 * 60 * 1000;
          let diffMinutes = diffMillis / 60000 - (breakTime * 60);
          if (diffMinutes < 0) diffMinutes = 0;
          dayMinutes = diffMinutes;
          const dayDecimalHours = diffMinutes / 60;
          dayGrossSalary = Math.max(0, dayDecimalHours * hourlyWage);
          dayNetSalary = Math.max(0, dayGrossSalary * (1 - taxRate));
          if (dayMinutes > 0 || breakTime > 0) hasEntry = true;
        } else if (startTime || endTime || breakTime > 0) { hasEntry = true; }
        totalMinutesPrecise += dayMinutes;
        totalGrossSalaryPrecise += dayGrossSalary;
        totalNetSalaryPrecise += dayNetSalary;
        if (hasEntry) daysWithEntries++;
      }
      const totalMinutesRounded = Math.round(totalMinutesPrecise);
      const totalHours = Math.floor(totalMinutesRounded / 60);
      const totalMinutesRemainder = totalMinutesRounded % 60;
      const totalDecimalHoursPrecise = totalMinutesPrecise / 60;
      const averageNetSalaryPrecise = daysWithEntries > 0 ? totalNetSalaryPrecise / daysWithEntries : 0;
      const averageWorkedMinutesPrecise = daysWithEntries > 0 ? totalMinutesPrecise / daysWithEntries : 0;
      const averageMinutesRounded = Math.round(averageWorkedMinutesPrecise);
      const averageHours = Math.floor(averageMinutesRounded / 60);
      const averageMinutes = averageMinutesRounded % 60;
      const averageDecimalHoursPrecise = averageWorkedMinutesPrecise / 60;
      totalSalaryDiv.innerHTML = `
        Počet započítaných dní: ${daysWithEntries}<br>
        Celkový odpracovaný čas: ${totalHours}h ${totalMinutesRemainder}m (${totalDecimalHoursPrecise.toFixed(decimalPlaces)} h)<br>
        Celková hrubá mzda: ${totalGrossSalaryPrecise.toFixed(decimalPlaces)}€<br>
        Celková čistá mzda: ${totalNetSalaryPrecise.toFixed(decimalPlaces)}€<br>
        Priemerná čistá mzda: ${averageNetSalaryPrecise.toFixed(decimalPlaces)}€<br>
        <strong>Priemerný odpracovaný čas: ${averageHours}h ${averageMinutes}m (${averageDecimalHoursPrecise.toFixed(decimalPlaces)} h)</strong>
      `;
    }
    function calculateAndUpdateTotals() {
      calculateTotal();
      const saveData = collectCurrentData();
      localStorage.setItem(`workData-${currentYear}-${currentMonth}`, JSON.stringify(saveData));
      debouncedSaveToFirestore();
    }
    function collectCurrentData() {
      const saveData = {
        data: [],
        hourlyWage: hourlyWage,
        taxRate: taxRate,
        employeeName: employeeName,
        decimalPlaces: decimalPlaces,
        lastUpdated: new Date().toISOString()
      };
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      for (let i = 1; i <= daysInMonth; i++) {
        const startElement = document.getElementById(`start-${currentYear}-${currentMonth}-${i}`);
        const endElement = document.getElementById(`end-${currentYear}-${currentMonth}-${i}`);
        const breakElement = document.getElementById(`break-${currentYear}-${currentMonth}-${i}`);
        const grossElement = document.getElementById(`gross-${currentYear}-${currentMonth}-${i}`);
        const netElement = document.getElementById(`net-${currentYear}-${currentMonth}-${i}`);
        const start = startElement ? startElement.value : '';
        const end = endElement ? endElement.value : '';
        const breakTime = breakElement ? breakElement.value : '';
        const gross = grossElement ? grossElement.value : '0.00';
        const net = netElement ? netElement.value : '0.00';
        saveData.data.push({ start, end, breakTime, gross, net });
      }
      return saveData;
    }
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => { func(...args); }, wait);
      };
    }
    const debouncedSaveToFirestore = debounce(saveToFirestore, 300);
    async function saveToFirestore() {
      if (!currentUser) return;
      const saveData = collectCurrentData();
      if (isOnline()) {
        try {
          showSyncSpinner(true);
          const userRef = doc(db, 'users', currentUser.uid);
          await setDoc(doc(userRef, 'workDays', `${currentYear}-${currentMonth}`), saveData);
          localStorage.removeItem(`pendingSync-${currentYear}-${currentMonth}`);
          showSaveNotification('Dáta synchronizované s Firebase.');
        } catch (error) {
          showErrorNotification('Chyba pri ukladaní do cloudu: ' + error.message);
          localStorage.setItem(`pendingSync-${currentYear}-${currentMonth}`, JSON.stringify(saveData));
        } finally { showSyncSpinner(false); }
      } else {
        localStorage.setItem(`pendingSync-${currentYear}-${currentMonth}`, JSON.stringify(saveData));
        showSaveNotification('Ste offline, dáta uložené lokálne.');
      }
    }
    async function syncWithFirebase() {
      if (!currentUser || !isOnline()) return;
      const pendingKey = `pendingSync-${currentYear}-${currentMonth}`;
      const pendingDataString = localStorage.getItem(pendingKey);
      if (pendingDataString) {
        try {
          showSyncSpinner(true);
          const dataToSync = JSON.parse(pendingDataString);
          const userRef = doc(db, 'users', currentUser.uid);
          await setDoc(doc(userRef, 'workDays', `${currentYear}-${currentMonth}`), dataToSync);
          localStorage.removeItem(pendingKey);
          showSaveNotification('Offline dáta boli synchronizované s Firebase.');
        } catch (error) {
          showErrorNotification('Chyba pri synchronizácii offline dát: ' + error.message);
        } finally { showSyncSpinner(false); }
      }
    }
    window.loadFromFirestore = async function() {
      if (!currentUser) { showErrorNotification('Pre načítanie z Firebase sa musíte prihlásiť.'); return; }
      if (!isOnline()) { showErrorNotification('Ste offline. Pre načítanie z Firebase je potrebné pripojenie na internet.'); return; }
      try {
        const userRef = doc(db, 'users', currentUser.uid);
        const docRef = doc(userRef, 'workDays', `${currentYear}-${currentMonth}`);
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          const storedData = docSnap.data();
          const dataString = JSON.stringify(storedData);
          if (confirm('Naozaj chcete načítať dáta z Firebase? Prepíšu sa tým všetky neuložené lokálne zmeny.')) {
            localStorage.setItem(`workData-${currentYear}-${currentMonth}`, dataString);
            localStorage.removeItem(`pendingSync-${currentYear}-${currentMonth}`);
            parseAndApplyData(dataString);
            showSaveNotification('Dáta boli úspešne načítané z Firebase.');
          }
        } else {
          showErrorNotification('Pre tento mesiac neboli vo Firebase nájdené žiadne dáta.');
        }
      } catch (error) {
        showErrorNotification('Chyba pri načítavaní dát z Firebase: ' + error.message);
      }
    }
    window.changeDecimalPlaces = function() {
      decimalPlaces = parseInt(decimalPlacesSelect.value);
      localStorage.setItem('decimalPlaces', JSON.stringify(decimalPlaces));
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      for (let i = 1; i <= daysInMonth; i++) {
        if (document.getElementById(`start-${currentYear}-${currentMonth}-${i}`)) {
          calculateRow(i);
        }
      }
      calculateAndUpdateTotals();
    }
    window.updateEmployeeName = function() {
      employeeName = employeeNameInput.value.trim();
      localStorage.setItem('employeeName', employeeName);
      calculateAndUpdateTotals();
    }
    window.updateSettings = function() {
      hourlyWage = parseFloat(hourlyWageInput.value) || 0;
      taxRate = (parseFloat(taxRateInput.value) || 0) / 100;
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      for (let i = 1; i <= daysInMonth; i++) {
        if (document.getElementById(`start-${currentYear}-${currentMonth}-${i}`)) {
          calculateRow(i);
        }
      }
      calculateAndUpdateTotals();
    }
    window.changeMonth = function() {
      currentMonth = parseInt(monthSelect.value);
      updateUI();
    }
    window.changeYear = function() {
      currentYear = parseInt(yearSelect.value);
      updateUI();
    }
    window.createBackup = function() {
      const key = `workData-${currentYear}-${currentMonth}`;
      const dataString = localStorage.getItem(key);
      if (dataString) {
        try {
          const dataObj = JSON.parse(dataString);
          const ws_data = [
            ["Deň", "Príchod", "Odchod", "Prestávka (h)", "Hrubá Mzda (€)", "Čistá Mzda (€)"]
          ];
          dataObj.data.forEach((row, index) => {
            ws_data.push([`Deň ${index+1}`, row.start, row.end, row.breakTime, row.gross, row.net]);
          });
          ws_data.push([]);
          ws_data.push(["Hodinová mzda", dataObj.hourlyWage]);
          ws_data.push(["Daňové percento", dataObj.taxRate * 100 + "%"]);
          ws_data.push(["Meno pracovníka", dataObj.employeeName]);
          ws_data.push(["Počet desatinných miest", dataObj.decimalPlaces]);
          ws_data.push(["Posledná aktualizácia", dataObj.lastUpdated]);
          const wb = XLSX.utils.book_new();
          const ws = XLSX.utils.aoa_to_sheet(ws_data);
          XLSX.utils.book_append_sheet(wb, ws, "Záloha");
          XLSX.writeFile(wb, `brunos-calculator-backup-${getMonthName(currentMonth)}-${currentYear}.xlsx`);
          showSaveNotification('Záloha bola úspešne vytvorená.');
        } catch(error) {
          showErrorNotification('Chyba pri vytváraní zálohy: ' + error.message);
        }
      } else {
        showErrorNotification('Nie sú dostupné žiadne lokálne dáta na zálohu.');
      }
    };
    window.restoreBackup = function() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet';
      input.onchange = function(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const sheetName = workbook.SheetNames[0];
            const ws = workbook.Sheets[sheetName];
            const rows = XLSX.utils.sheet_to_json(ws, { header: 1, defval: "" });
            const headerRowIndex = rows.findIndex(row => row[0]?.toString().toLowerCase() === "deň");
            if (headerRowIndex === -1) throw new Error("Hlavička tabuľky ('Deň', 'Príchod', ...) nebola nájdená.");
            const header = rows[headerRowIndex];
            let dataArray = [];
            let settings = {};
            let i = headerRowIndex + 1;
            const dayIndex = header.findIndex(h => h?.toString().toLowerCase().includes("deň"));
            const startIndex = header.findIndex(h => h?.toString().toLowerCase().includes("príchod"));
            const endIndex = header.findIndex(h => h?.toString().toLowerCase().includes("odchod"));
            const breakIndex = header.findIndex(h => h?.toString().toLowerCase().includes("prestávka"));
            const grossIndex = header.findIndex(h => h?.toString().toLowerCase().includes("hrubá mzda"));
            const netIndex = header.findIndex(h => h?.toString().toLowerCase().includes("čistá mzda"));
            if (startIndex === -1 || endIndex === -1 || breakIndex === -1 || grossIndex === -1 || netIndex === -1) {
              throw new Error("Nepodarilo sa nájsť všetky požadované stĺpce v hlavičke.");
            }
            for (; i < rows.length; i++) {
              const row = rows[i];
              if (!row || row.length === 0 || !row[dayIndex]?.toString().toLowerCase().startsWith("deň")) break;
              dataArray.push({
                start: row[startIndex] !== undefined ? row[startIndex].toString() : "",
                end: row[endIndex] !== undefined ? row[endIndex].toString() : "",
                breakTime: row[breakIndex] !== undefined ? row[breakIndex].toString() : "",
                gross: row[grossIndex] !== undefined ? row[grossIndex].toString() : "0.00",
                net: row[netIndex] !== undefined ? row[netIndex].toString() : "0.00"
              });
            }
            for (; i < rows.length; i++) {
              const row = rows[i];
              if (row && row.length > 1 && row[0]) {
                const key = row[0].toString().toLowerCase();
                const value = row[1]?.toString() || "";
                if (key.includes("hodinová mzda")) settings.hourlyWage = parseFloat(value) || 0;
                else if (key.includes("daňové percento")) settings.taxRate = (parseFloat(value.replace('%','')) || 0) / 100;
                else if (key.includes("meno pracovníka")) settings.employeeName = value;
                else if (key.includes("počet desatinných miest")) settings.decimalPlaces = parseInt(value) || 1;
                else if (key.includes("posledná aktualizácia")) settings.lastUpdated = value;
              }
            }
            const backupData = {
              data: dataArray,
              hourlyWage: settings.hourlyWage !== undefined ? settings.hourlyWage : (parseFloat(hourlyWageInput.value) || 0),
              taxRate: settings.taxRate !== undefined ? settings.taxRate : ((parseFloat(taxRateInput.value) || 0) / 100),
              employeeName: settings.employeeName !== undefined ? settings.employeeName : (employeeNameInput.value || ""),
              decimalPlaces: settings.decimalPlaces !== undefined ? settings.decimalPlaces : (parseInt(decimalPlacesSelect.value) || 1),
              lastUpdated: settings.lastUpdated || new Date().toISOString()
            };
            localStorage.setItem(`workData-${currentYear}-${currentMonth}`, JSON.stringify(backupData));
            parseAndApplyData(JSON.stringify(backupData));
            showSaveNotification('Záloha bola úspešne obnovená a načítaná.');
            if (currentUser && isOnline()) { saveToFirestore(); }
          } catch (error) {
            showErrorNotification('Chyba pri načítavaní zálohy: ' + error.message);
          }
        };
        reader.onerror = function() { showErrorNotification('Chyba pri čítaní súboru.'); }
        reader.readAsArrayBuffer(file);
      };
      input.click();
    };
    function getMonthName(month) {
      const monthNames = ["Január", "Február", "Marec", "Apríl", "Máj", "Jún", "Júl", "August", "September", "Október", "November", "December"];
      return monthNames[month];
    }
    window.exportToPDF = function() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFont('Helvetica');
      doc.setFontSize(18);
      doc.text(`Bruno's Calculator - Výkaz práce (${getMonthName(currentMonth)} ${currentYear})`, 14, 20);
      doc.setFontSize(14);
      doc.text(`Meno pracovníka: ${employeeName}`, 14, 25);
      const tableData = [];
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      for (let i = 1; i <= daysInMonth; i++) {
        const dayName = getDayName(currentYear, currentMonth, i);
        const startTime = document.getElementById(`start-${currentYear}-${currentMonth}-${i}`)?.value || '';
        const endTime = document.getElementById(`end-${currentYear}-${currentMonth}-${i}`)?.value || '';
        const breakTime = document.getElementById(`break-${currentYear}-${currentMonth}-${i}`)?.value || '';
        const totalTime = document.getElementById(`total-${currentYear}-${currentMonth}-${i}`)?.textContent || '';
        const grossSalary = document.getElementById(`gross-${currentYear}-${currentMonth}-${i}`)?.value || '';
        const netSalary = document.getElementById(`net-${currentYear}-${currentMonth}-${i}`)?.value || '';
        if (startTime || endTime || (breakTime && parseFloat(breakTime) >= 0)) {
          tableData.push([`Deň ${i} (${dayName})`, startTime, endTime, breakTime || '0', totalTime, grossSalary, netSalary]);
        }
      }
      doc.autoTable({
        head: [['Deň', 'Príchod', 'Odchod', 'Prestávka (h)', 'Odpracované', 'Hrubá Mzda (€)', 'Čistá Mzda (€)']],
        body: tableData,
        startY: 30,
      });
      const totalY = doc.lastAutoTable.finalY + 10;
      doc.setFontSize(12);
      const totalTextContent = totalSalaryDiv.innerHTML.replace(/<br>/g, '\n').replace(/<strong>|<\/strong>/g, '');
      doc.text(totalTextContent, 14, totalY);
      doc.save(`brunos-calculator-report-${getMonthName(currentMonth)}-${currentYear}.pdf`);
    }
    window.sendPDF = function() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFont('Helvetica');
      doc.setFontSize(18);
      doc.text(`Bruno's Calculator - Výkaz práce (${getMonthName(currentMonth)} ${currentYear})`, 14, 20);
      doc.setFontSize(14);
      doc.text(`Meno pracovníka: ${employeeName}`, 14, 25);
      const tableData = [];
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      for (let i = 1; i <= daysInMonth; i++) {
        const dayName = getDayName(currentYear, currentMonth, i);
        const startTime = document.getElementById(`start-${currentYear}-${currentMonth}-${i}`)?.value || '';
        const endTime = document.getElementById(`end-${currentYear}-${currentMonth}-${i}`)?.value || '';
        const breakTime = document.getElementById(`break-${currentYear}-${currentMonth}-${i}`)?.value || '';
        const totalTime = document.getElementById(`total-${currentYear}-${currentMonth}-${i}`)?.textContent || '';
        const grossSalary = document.getElementById(`gross-${currentYear}-${currentMonth}-${i}`)?.value || '';
        const netSalary = document.getElementById(`net-${currentYear}-${currentMonth}-${i}`)?.value || '';
        if (startTime || endTime || (breakTime && parseFloat(breakTime) >= 0)) {
          tableData.push([`Deň ${i} (${dayName})`, startTime, endTime, breakTime || '0', totalTime, grossSalary, netSalary]);
        }
      }
      doc.autoTable({
        head: [['Deň', 'Príchod', 'Odchod', 'Prestávka (h)', 'Odpracované', 'Hrubá Mzda (€)', 'Čistá Mzda (€)']],
        body: tableData,
        startY: 30,
      });
      const totalY = doc.lastAutoTable.finalY + 10;
      doc.setFontSize(12);
      const totalTextContent = totalSalaryDiv.innerHTML.replace(/<br>/g, '\n').replace(/<strong>|<\/strong>/g, '');
      doc.text(totalTextContent, 14, totalY);
      const pdfBlob = doc.output('blob');
      const pdfFile = new File([pdfBlob], `brunos-calculator-report-${getMonthName(currentMonth)}-${currentYear}.pdf`, { type: 'application/pdf' });
      if (navigator.canShare && navigator.canShare({ files: [pdfFile] })) {
        navigator.share({
          files: [pdfFile],
          title: `Bruno's Calculator Report`,
          text: `Pozrite si výkaz práce za ${getMonthName(currentMonth)} ${currentYear}`
        }).catch(error => {
          alert('Chyba pri odosielaní PDF: ' + error.message);
        });
      } else {
        alert('Funkcia zdieľania súborov nie je podporovaná vo vašom prehliadači.');
      }
    }
    // -------------------- INIT --------------------
    onAuthStateChanged(auth, (user) => {
      currentUser = user;
      updateUI();
    });
  </script>

  <!-- Registrácia Service Workera -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then(registration => {
            console.log('Service Worker zaregistrovaný úspešne s rozsahom:', registration.scope);
          })
          .catch(error => {
            console.error('Registrácia Service Workera zlyhala:', error);
          });
      });
    }
  </script>
</body>
</html>
