<!DOCTYPE html>
<html lang="sk">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>Bruno's Calculator</title>

Â  Â  <link rel="manifest" href="./manifest.json" />

Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.15/jspdf.plugin.autotable.min.js"></script>
Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

Â  <style>
Â  Â  /* ZÃ¡kladnÃ© Å¡tÃ½ly */
Â  Â  body {
Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  Â  line-height: 1.6;
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 10px;
Â  Â  Â  background-color: #f4f4f4;
Â  Â  Â  color: #333;
Â  Â  }
Â  Â  .container {
Â  Â  Â  max-width: 1200px;
Â  Â  Â  margin: auto;
Â  Â  Â  background: white;
Â  Â  Â  padding: 15px;
Â  Â  Â  border-radius: 5px;
Â  Â  Â  box-shadow: 0 0 10px rgba(0,0,0,0.1);
Â  Â  Â  position: relative;
Â  Â  }
Â  Â  h1 {
Â  Â  Â  text-align: center;
Â  Â  Â  font-size: 2.5em;
Â  Â  Â  /* color: black; */ /* PÃ´vodnÃ¡ farba odstrÃ¡nenÃ¡, riadi sa inline Å¡tÃ½lom alebo JS */
Â  Â  Â  margin-bottom: 10px;
Â  Â  }
Â  Â  h2 {
Â  Â  Â  text-align: center;
Â  Â  Â  color: #555;
Â  Â  Â  margin-top: -10px;
Â  Â  Â  font-size: 1.2em;
Â  Â  }
Â  Â  .settings {
Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  display: flex;
Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  align-items: flex-start;
Â  Â  }
Â  Â  .settings > div, .settings > button#toggleSettingsBtn, .settings > button.highlight {
Â  Â  Â  margin: 2px 5px;
Â  Â  }
Â  Â  .settings > div {
Â  Â  Â  flex: 1 1 200px;
Â  Â  }
Â  Â  .settings > button#toggleSettingsBtn {
Â  Â  Â  flex-basis: 100%;
Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  background-color: #eee;
Â  Â  Â  color: #333;
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  text-align: left;
Â  Â  Â  padding: 8px 12px;
Â  Â  Â  cursor: pointer;
Â  Â  }
Â  Â  body.dark-mode .settings > button#toggleSettingsBtn {
Â  Â  Â  Â  background-color: #555;
Â  Â  Â  Â  color: #f4f4f4;
Â  Â  Â  Â  border-color: #666;
Â  Â  }
Â  Â  .settings > button.highlight {
Â  Â  Â  Â flex: 1 1 150px;
Â  Â  Â }
Â  Â  .settings label {
Â  Â  Â  display: block;
Â  Â  Â  margin-bottom: 2px;
Â  Â  }
Â  Â  #settings-collapsible-content {
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  max-height: 0;
Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  transition: max-height 0.4s ease-out, opacity 0.3s ease-out;
Â  Â  }
Â  Â  #settings-collapsible-content.visible {
Â  Â  Â  Â  max-height: 400px;
Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  margin-top: 5px;
Â  Â  }
Â  Â  #settings-collapsible-content > div {
Â  Â  Â  Â  Â flex: 1 1 200px;
Â  Â  Â  Â  Â margin: 2px 5px;
Â  Â  }
Â  Â  .table-container {
Â  Â  Â  overflow-x: auto;
Â  Â  }
Â  Â  table {
Â  Â  Â  width: 100%;
Â  Â  Â  border-collapse: collapse;
Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  min-width: 800px;
Â  Â  Â  /* --- NOVÃ‰: Table-layout fixed pre lepÅ¡iu kontrolu Å¡Ã­rky --- */
Â  Â  Â  table-layout: fixed;
Â  Â  }
Â  Â  th, td {
Â  Â  Â  padding: 8px;
Â  Â  Â  border: 1px solid #ddd;
Â  Â  Â  text-align: left;
Â  Â  Â  font-size: 0.9em;
Â  Â  Â  vertical-align: middle;
Â  Â  Â  /* --- NOVÃ‰: Word-wrap pre prÃ­pad, Å¾e by obsah bol Å¡irÅ¡Ã­ --- */
Â  Â  Â  word-wrap: break-word;
Â  Â  }
Â  Â  th {
Â  Â  Â  background-color: #f2f2f2;
Â  Â  }

Â  Â  /* --- Å ÃRKA STÄ¹PCOV: Tu mÃ´Å¾ete upravovaÅ¥ Å¡Ã­rku jednotlivÃ½ch stÄºpcov --- */
Â  Â  /* PrÃ­klad: DeÅˆ (1. stÄºpec) */
Â  Â  th:nth-child(1), td:nth-child(1) {
Â  Â  Â  width: 12%; /* Alebo inÃ¡ hodnota, napr. 90px */
Â  Â  }
Â  Â  /* --- Å ÃRKA STÄ¹PCOV: PrÃ­chod a Odchod (2. a 3. stÄºpec) --- */
Â  Â  /* Upravte hodnotu 'width' podÄ¾a potreby */
Â  Â  th:nth-child(2), td:nth-child(2), /* PrÃ­chod */
Â  Â  th:nth-child(3), td:nth-child(3) { /* Odchod */
Â  Â  Â  width: 30%; /* SkÃºste hodnoty ako 10%, 12%, alebo napr. 85px */
Â  Â  Â  /* text-align: center; /* VoliteÄ¾nÃ©: Centrovanie Äasu */
Â  Â  }
Â  Â  /* --- KONIEC ÃšPRAVY Å ÃRKY: PrÃ­chod a Odchod --- */

Â  Â  /* PrÃ­klad: PrestÃ¡vka (4. stÄºpec) */
Â  Â  th:nth-child(4), td:nth-child(4) {
Â  Â  Â  Â  width: 10%;
Â  Â  Â  Â  text-align: center; /* Centrovanie ÄÃ­selnÃ©ho vstupu */
Â  Â  }
Â  Â  /* PrÃ­klad: OdpracovanÃ© (5. stÄºpec) */
Â  Â  Â th:nth-child(5), td:nth-child(5) {
Â  Â  Â  Â  Â width: 16%; /* Trochu viac miesta pre "Xh Ym (Z.Z h)" */
Â  Â  Â }
Â  Â  /* PrÃ­klad: Mzdy (6. a 7. stÄºpec) */
Â  Â  th:nth-child(6), td:nth-child(6), /* HrubÃ¡ mzda */
Â  Â  th:nth-child(7), td:nth-child(7) { /* ÄŒistÃ¡ mzda */
Â  Â  Â  Â  Â width: 15%;
Â  Â  Â  Â  Â text-align: right; /* Zarovnanie miezd doprava */
Â  Â  Â }
Â  Â  /* PrÃ­klad: Akcia (8. stÄºpec) */
Â  Â  th:nth-child(8), td:nth-child(8) {
Â  Â  Â  Â  width: 10%;
Â  Â  Â  Â  text-align: center; /* Centrovanie tlaÄidla */
Â  Â  }
Â  Â  /* --- KONIEC DEFINÃCIE Å ÃROK STÄ¹PCOV --- */


Â  Â  input[type="tel"], input[type="number"], input[type="text"], select {
Â  Â  Â  padding: 5px;
Â  Â  Â  box-sizing: border-box;
Â  Â  Â  background-color: #ffffd0;
Â  Â  Â  font-size: 14px;
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  border-radius: 3px;
Â  Â  Â  vertical-align: middle;
Â  Â  Â  /* --- ZMENA: Nastavenie max-width, aby sa zmestili do bunky --- */
Â  Â  Â  max-width: 100%; /* Inputy by nemali pretekaÅ¥ */
Â  Â  }
Â  Â  input[type="number"], input[type="text"], select {
Â  Â  Â  Â  width: 100%; /* Tieto stÃ¡le mÃ´Å¾u zabraÅ¥ 100% Å¡Ã­rky rodiÄa (td) */
Â  Â  }

Â  Â  .result { /* ... zvyÅ¡ok CSS bez zmien ... */ }
Â  Â  .btn-container { /* ... */ }
Â  Â  .btn { /* ... */ }
Â  Â  .reset-btn { background-color: #f44336; }
Â  Â  .reset-btn:hover { background-color: #d32f2f; }
Â  Â  .export-btn { background-color: #4CAF50; }
Â  Â  .export-btn:hover { background-color: #388e3c; }
Â  Â  .backup-btn { background-color: #8a2be2; padding: 15px 20px; }
Â  Â  .backup-btn:hover { background-color: #6a1bb2; }
Â  Â  .highlight { background-color: #ffcc00; color: #333; font-weight: bold; border: 2px solid #ffcc00; }
Â  Â  #totalSalary { /* ... */ }
Â  Â  #dataSizeContainer { /* ... */ }
Â  Â  #dataSizeText { /* ... */ }
Â  Â  #dataSizeBar { /* ... */ }
Â  Â  #dataSizeFill { /* ... */ }
Â  Â  .current-day { background-color: #8a2be2; color: white; }
Â  Â  .current-day input { background-color: #9932cc; color: white; }

Â  Â  /* TmavÃ½ reÅ¾im */
Â  Â  body.dark-mode { background-color: #333; color: #f4f4f4; }
Â  Â  body.dark-mode .container { background-color: #444; color: #f4f4f4; }
Â  Â  body.dark-mode h1 { color: #f4f4f4; } /* Zmena farby pre tmavÃ½ reÅ¾im */
Â  Â  body.dark-mode table { background-color: #555; color: #f4f4f4; }
Â  Â  body.dark-mode th { background-color: #666; }
Â  Â  body.dark-mode td { background-color: #444; color: #f4f4f4; border-color: #555; }
Â  Â  body.dark-mode input[type="tel"], body.dark-mode input[type="number"], body.dark-mode input[type="text"], body.dark-mode select { background-color: #666; color: white; border-color: #555; }
Â  Â  body.dark-mode .btn { color: #f4f4f4; }
Â  Â  body.dark-mode .reset-btn { background-color: #d32f2f; }
Â  Â  body.dark-mode .export-btn { background-color: #388e3c; }
Â  Â  body.dark-mode .backup-btn { background-color: #6a1bb2; }
Â  Â  body.dark-mode #totalSalary { background-color: #2c3e50; }
Â  Â  body.dark-mode .current-day { background-color: #4a0e8f; color: #fff; }
Â  Â  body.dark-mode .current-day input { background-color: #5c1db3; color: #fff; border-color: #4a0e8f; }
Â  Â  body.dark-mode .settings > button#toggleSettingsBtn { background-color: #555; color: #f4f4f4; border-color: #666; }
    body.dark-mode #mainTitle { color: lightgreen; } /* ZelenÃ¡ aj pre tmavÃ½ reÅ¾im */


Â  Â  /* Responzivita */
Â  Â  @media (max-width: 768px) {
Â  Â  Â  body { padding: 5px; }
Â  Â  Â  .container { padding: 10px; }
Â  Â  Â  h1 { font-size: 1.8em; }
Â  Â  Â  h2 { font-size: 1em; }
Â  Â  Â  .settings { flex-direction: column; align-items: stretch; }
Â  Â  Â  .settings > div, .settings > button#toggleSettingsBtn, .settings > button.highlight { width: 100%; margin: 5px 0; flex-basis: auto; }
Â  Â  Â  #settings-collapsible-content { flex-direction: column; align-items: stretch; }
Â  Â  Â  #settings-collapsible-content > div { width: 100%; margin: 5px 0; flex-basis: auto; }
Â  Â  Â  #settings-collapsible-content.visible { max-height: 600px; }
Â  Â  Â  table { min-width: 600px; } /* MÃ´Å¾e byÅ¥ potrebnÃ© upraviÅ¥ podÄ¾a novÃ½ch Å¡Ã­rok */
Â  Â  Â  th, td { padding: 6px; font-size: 0.8em; }
Â  Â  Â  .btn-container { flex-direction: column; align-items: stretch; }
Â  Â  Â  .btn { flex: 1 1 auto; font-size: 14px; padding: 8px 16px; margin: 5px 0; }
Â  Â  Â  .backup-btn { padding: 15px 16px; }
Â  Â  Â  #totalSalary { font-size: 16px; }
Â  Â  }
Â  Â  @media (max-width: 480px) {
Â  Â  Â  h1 { font-size: 1.5em; }
Â  Â  Â  th, td { font-size: 0.7em; }
Â  Â  Â  .btn { font-size: 12px; padding: 6px 12px; }
Â  Â  Â  .backup-btn { padding: 15px 12px; }
Â  Â  Â  .settings label { font-size: 0.9em; }
Â  Â  Â  input[type="tel"], input[type="number"], input[type="text"], select { font-size: 12px; }
Â  Â  Â  table { min-width: 500px; } /* MÃ´Å¾e byÅ¥ potrebnÃ© upraviÅ¥ podÄ¾a novÃ½ch Å¡Ã­rok */
Â  Â  Â  #settings-collapsible-content.visible { max-height: 700px; }
Â  Â  Â  /* Å Ã­rky stÄºpcov pre mobil - mÃ´Å¾ete prepÃ­saÅ¥, ak sÃº prÃ­liÅ¡ Ãºzke/Å¡irokÃ© */
Â  Â  Â  /* Napr. th:nth-child(2), td:nth-child(2), th:nth-child(3), td:nth-child(3) { width: 15%; } */
Â  Â  }

Â  Â  /* NotifikÃ¡cie a Login forma */
Â  Â  #saveNotification, #errorNotification { /* ... */ }
Â  Â  #saveNotification.show, #errorNotification.show { /* ... */ }
Â  Â  #saveNotification { /* ... */ }
Â  Â  #errorNotification { /* ... */ }
Â  Â  #login-form { /* ... */ }
Â  Â  #login-form input[type="email"], #login-form input[type="password"] { /* ... */ }
Â  Â  #login-form .btn { /* ... */ }
Â  Â  #login-form a { /* ... */ }
Â  Â  #login-form a:hover { /* ... */ }
Â  Â  body.dark-mode #login-form a { /* ... */ }

Â  Â  /* Å tÃ½ly pre wrapper a ikonu hodÃ­n */
Â  Â  .time-input-wrapper {
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  gap: 5px;
Â  Â  Â  Â  max-width: 100%;
Â  Â  Â  Â  box-sizing: border-box;
Â  Â  }
Â  Â  .time-input-wrapper input[type="tel"] {
Â  Â  Â  Â  flex-grow: 1;
Â  Â  Â  Â  min-width: 45px; /* ZmenÅ¡enÃ© minimum pre Ãºzke stÄºpce */
Â  Â  Â  Â  /* --- ZMENA: OdstrÃ¡nenÃ© max-width, width riadi rodiÄ (td) --- */
Â  Â  Â  Â  /* max-width: 100%; */
Â  Â  Â  Â  /* width: auto; */ /* NechÃ¡me prehliadaÄ/flexbox rozhodnÃºÅ¥ */
Â  Â  }
Â  Â  .clock-icon {
Â  Â  Â  Â  flex-shrink: 0;
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  font-size: 1.3em;
Â  Â  Â  Â  user-select: none;
Â  Â  Â  Â  transition: transform 0.2s ease;
Â  Â  Â  Â  padding: 2px;
Â  Â  Â  Â  line-height: 1;
Â  Â  }
Â  Â  .clock-icon:hover { opacity: 0.8; }
Â  Â  .clock-icon:active { transform: scale(0.9); }
Â  Â  body.dark-mode .clock-icon { /* filter: brightness(1.2); */ }

Â  </style>
</head>
<body>
Â  Â  <div class="container">
Â  Â  Â  Â  <div id="auth-container" style="text-align: center; margin-bottom: 20px;">
Â  Â  Â  <div id="login-form" style="display: none;">
Â  Â  Â  Â  <input type="email" id="email" placeholder="Email">
Â  Â  Â  Â  <input type="password" id="password" placeholder="Heslo">
Â  Â  Â  Â  <button class="btn export-btn" onclick="login()">PrihlÃ¡siÅ¥ sa</button>
Â  Â  Â  Â  <button class="btn export-btn" onclick="register()">RegistrovaÅ¥</button>
Â  Â  Â  Â  <a href="#" onclick="resetPassword(); return false;">Zabudli ste heslo?</a>
Â  Â  Â  </div>
Â  Â  Â  <div id="user-info" style="display: none;">
Â  Â  Â  Â  <span id="user-email"></span>
Â  Â  Â  Â  <button class="btn reset-btn" onclick="logout()">OdhlÃ¡siÅ¥ sa</button>
Â  Â  Â  </div>
Â  Â  </div>

    Â  Â  <h1 id="mainTitle" style="color: green;">Vitaj spÃ¤Å¥ ğŸ‘‹</h1>
Â  Â  <h2></h2>

Â  Â  Â  Â  <div class="settings">
Â  Â  Â  <button id="toggleSettingsBtn" class="btn">ZobraziÅ¥ nastavenia â–¼</button>
Â  Â  Â  <div id="settings-collapsible-content">
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label for="employeeNameInput">Meno pracovnÃ­ka: </label>
Â  Â  Â  Â  Â  Â  <input type="text" id="employeeNameInput" placeholder="Zadajte meno pracovnÃ­ka" oninput="updateEmployeeName()">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label for="hourlyWageInput">HodinovÃ¡ mzda (â‚¬): </label>
Â  Â  Â  Â  Â  Â  <input type="number" id="hourlyWageInput" value="10" min="0" step="0.1" oninput="updateSettings()">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label for="taxRateInput">DaÅˆovÃ© percento (%): </label>
Â  Â  Â  Â  Â  Â  <input type="number" id="taxRateInput" value="2" min="0" step="0.1" oninput="updateSettings()">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label for="monthSelect">Mesiac: </label>
Â  Â  Â  Â  Â  Â  <select id="monthSelect" onchange="changeMonth()">
Â  Â  Â  Â  Â  Â  Â  <option value="0">JanuÃ¡r</option> <option value="1">FebruÃ¡r</option> <option value="2">Marec</option>
Â  Â  Â  Â  Â  Â  Â  <option value="3">AprÃ­l</option> <option value="4">MÃ¡j</option> <option value="5">JÃºn</option>
Â  Â  Â  Â  Â  Â  Â  <option value="6">JÃºl</option> <option value="7">August</option> <option value="8">September</option>
Â  Â  Â  Â  Â  Â  Â  <option value="9">OktÃ³ber</option> <option value="10">November</option> <option value="11">December</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label for="yearSelect">Rok: </label>
Â  Â  Â  Â  Â  Â  <select id="yearSelect" onchange="changeYear()"></select>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label for="decimalPlacesSelect">PoÄet desatinnÃ½ch miest: </label>
Â  Â  Â  Â  Â  Â  <select id="decimalPlacesSelect" onchange="changeDecimalPlaces()">
Â  Â  Â  Â  Â  Â  Â  <option value="1">1</option>
Â  Â  Â  Â  Â  Â  Â  <option value="2">2</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  Â <button onclick="toggleDarkMode()" class="btn highlight">PrepÃ­naÅ¥ tmavÃ½ reÅ¾im</button>
Â  Â  </div>

Â  Â  <div class="table-container">
Â  Â  Â  <table>
Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  <th>DeÅˆ</th>
Â  Â  Â  Â  Â  Â  <th>PrÃ­chod</th>
Â  Â  Â  Â  Â  Â  <th>Odchod</th>
Â  Â  Â  Â  Â  Â  <th>PrestÃ¡vka</th>
Â  Â  Â  Â  Â  Â  <th>OdpracovanÃ©</th>
Â  Â  Â  Â  Â  Â  <th>HrubÃ¡ Mzda (â‚¬)</th>
Â  Â  Â  Â  Â  Â  <th>ÄŒistÃ¡ Mzda (â‚¬)</th>
Â  Â  Â  Â  Â  Â  <th>Akcia</th>
Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  </thead>
Â  Â  Â  Â  <tbody id="workDays">
Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  </table>
Â  Â  </div>

Â  Â  <div id="totalSalary"></div>

Â  Â  <div class="btn-container">
Â  Â  Â  <button class="btn export-btn" onclick="exportToPDF()">ExportovaÅ¥ do PDF</button>
Â  Â  Â  <button class="btn export-btn" onclick="sendPDF()">OdoslaÅ¥ PDF</button>
Â  Â  Â  <button class="btn export-btn" onclick="restoreBackup()">ObnoviÅ¥ zÃ¡lohu</button>
Â  Â  Â  <button class="btn backup-btn" onclick="createBackup()">VytvoriÅ¥ zÃ¡lohu</button>
Â  Â  Â  <button class="btn export-btn" onclick="loadFromFirestore()">NaÄÃ­tanie z Firebase</button>
Â  Â  </div>
Â  </div>

Â  <div id="saveNotification">DÃ¡ta boli ÃºspeÅ¡ne uloÅ¾enÃ©</div>
Â  <div id="errorNotification"></div>

Â  Â  <script type="module">
Â  Â  // ReÅ¾im
Â  Â  if (localStorage.getItem('darkMode') === 'true') document.body.classList.add('dark-mode');
Â  Â  window.toggleDarkMode = () => {
Â  Â  Â  document.body.classList.toggle('dark-mode');
Â  Â  Â  localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
Â  Â  }

Â  Â  // Firebase Importy
Â  Â  import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
Â  Â  import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';
Â  Â  import { getFirestore, collection, doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';
Â  Â  import { initializeAppCheck, ReCaptchaV3Provider } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app-check.js';

Â  Â  // Firebase KonfigurÃ¡cia
Â  Â  const firebaseConfig = {
Â  Â  Â  Â  apiKey: "AIzaSyBdLtJlduT3iKiGLDJ0UfAakpf6wcresnk",
Â  Â  Â  Â  authDomain: "uuuuu-f7ef9.firebaseapp.com",
Â  Â  Â  Â  projectId: "uuuuu-f7ef9",
Â  Â  Â  Â  storageBucket: "uuuuu-f7ef9.appspot.com",
Â  Â  Â  Â  messagingSenderId: "456105865458",
Â  Â  Â  Â  appId: "1:456105865458:web:101f0a4dcb455f174b606b",
Â  Â  };

Â  Â  // Firebase InicializÃ¡cia
Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  try {
Â  Â  Â  Â  initializeAppCheck(app, {
Â  Â  Â  Â  Â  Â  provider: new ReCaptchaV3Provider('6LczmP0qAAAAAACGalBT9zZekkUr3hLgA2e8o99v'),
Â  Â  Â  Â  Â  Â  isTokenAutoRefreshEnabled: true
Â  Â  Â  Â  });
Â  Â  } catch (e) { console.warn("Firebase App Check failed to initialize.", e); }
Â  Â  const auth = getAuth(app);
Â  Â  const db = getFirestore(app);

Â  Â  // GlobÃ¡lne PremennÃ© a Elementy
Â  Â  let currentUser = null;
Â  Â  const workDays = document.getElementById('workDays');
Â  Â  const totalSalaryDiv = document.getElementById('totalSalary');
Â  Â  const mainTitle = document.getElementById('mainTitle');
Â  Â  const hourlyWageInput = document.getElementById('hourlyWageInput');
Â  Â  const taxRateInput = document.getElementById('taxRateInput');
Â  Â  const monthSelect = document.getElementById('monthSelect');
Â  Â  const yearSelect = document.getElementById('yearSelect');
Â  Â  const decimalPlacesSelect = document.getElementById('decimalPlacesSelect');
Â  Â  const employeeNameInput = document.getElementById('employeeNameInput');
Â  Â  const toggleSettingsBtn = document.getElementById('toggleSettingsBtn');
Â  Â  const settingsCollapsibleContent = document.getElementById('settings-collapsible-content');

Â  Â  const currentDate = new Date();
Â  Â  let currentMonth = currentDate.getMonth();
Â  Â  let currentYear = currentDate.getFullYear();
Â  Â  let decimalPlaces = parseInt(localStorage.getItem('decimalPlaces')) || 1;
Â  Â  let employeeName = localStorage.getItem('employeeName') || '';
Â  Â  let hourlyWage = 10;
Â  Â  let taxRate = 0.02;

    // ZMENENÃ FUNKCIA: AktualizÃ¡cia pozdravu
Â  Â  function updateGreeting() {
Â  Â  Â  Â  const nameToUse = employeeName || localStorage.getItem('employeeName') || '';
Â  Â  Â  Â  if (nameToUse) {
            // PouÅ¾ijeme innerHTML pre emoji a meno
Â  Â  Â  Â  Â  Â  mainTitle.innerHTML = `Vitaj spÃ¤Å¥ ${nameToUse.split(' ')[0]} ğŸ‘‹`;
Â  Â  Â  Â  } else {
            // ZÃ¡kladnÃ½ pozdrav, ak meno nie je zadanÃ©
Â  Â  Â  Â  Â  Â  mainTitle.innerHTML = `Vitaj spÃ¤Å¥ ğŸ‘‹`;
Â  Â  Â  Â  }
        // Aplikujeme zelenÃº farbu (aj keÄ uÅ¾ mÃ´Å¾e byÅ¥ nastavenÃ¡ cez inline Å¡tÃ½l)
        mainTitle.style.color = document.body.classList.contains('dark-mode') ? 'lightgreen' : 'green';
Â  Â  }

Â  Â  // PopulÃ¡cia a nastavenie rokov
Â  Â  function populateYearSelect() {
Â  Â  Â  Â  const startYear = 2020; const endYear = 2030;
Â  Â  Â  Â  yearSelect.innerHTML = '';
Â  Â  Â  Â  for (let y = startYear; y <= endYear; y++) {
Â  Â  Â  Â  Â  Â  const option = document.createElement('option'); option.value = y; option.textContent = y; yearSelect.appendChild(option);
Â  Â  Â  Â  }
Â  Â  Â  Â  yearSelect.value = currentYear;
Â  Â  }
Â  Â  populateYearSelect();

Â  Â  // InicializÃ¡cia hodnÃ´t z localStorage alebo UI
Â  Â  hourlyWage = parseFloat(localStorage.getItem('hourlyWage') || hourlyWageInput.value) || 10;
Â  Â  taxRate = (parseFloat(localStorage.getItem('taxRatePercent') || taxRateInput.value) || 2) / 100;
Â  Â  decimalPlaces = parseInt(localStorage.getItem('decimalPlaces') || decimalPlacesSelect.value) || 1;
Â  Â  employeeName = localStorage.getItem('employeeName') || employeeNameInput.value || '';

Â  Â  // Nastavenie UI prvkov
Â  Â  monthSelect.value = currentMonth; yearSelect.value = currentYear; decimalPlacesSelect.value = decimalPlaces;
Â  Â  employeeNameInput.value = employeeName; hourlyWageInput.value = hourlyWage; taxRateInput.value = (taxRate * 100).toFixed(1);

Â  Â  updateGreeting(); // Volanie funkcie na nastavenie pozdravu pri Å¡tarte

Â  Â  // Listener pre skrytie/zobrazenie nastavenÃ­
Â  Â  if (toggleSettingsBtn && settingsCollapsibleContent) {
Â  Â  Â  Â  toggleSettingsBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  const isVisible = settingsCollapsibleContent.classList.toggle('visible');
Â  Â  Â  Â  Â  Â  toggleSettingsBtn.textContent = isVisible ? 'SkryÅ¥ nastavenia â–²' : 'ZobraziÅ¥ nastavenia â–¼';
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // Online/Offline monitoring a NotifikÃ¡cie
Â  Â  function isOnline() { return navigator.onLine; }
Â  Â  window.addEventListener('online', () => { showStatusNotification('Online', 'green'); syncWithFirebase(); });
Â  Â  window.addEventListener('offline', () => { showStatusNotification('Offline', 'red'); });
Â  Â  function showStatusNotification(message, color) { const n = document.createElement('div'); n.textContent = message; n.style.cssText = `position:fixed; top:20px; right:20px; padding:10px 20px; border-radius:5px; background-color:${color}; color:white; z-index:1000; box-shadow:0 2px 5px rgba(0,0,0,0.2);`; document.body.appendChild(n); setTimeout(() => n.remove(), 3000); }
Â  Â  function showErrorNotification(message) { const n = document.getElementById('errorNotification'); n.textContent = message; n.classList.add('show'); setTimeout(() => n.classList.remove('show'), 4000); }
Â  Â  function showSaveNotification(message = 'DÃ¡ta boli ÃºspeÅ¡ne uloÅ¾enÃ©') { const n = document.getElementById('saveNotification'); n.textContent = message; n.classList.add('show'); setTimeout(() => n.classList.remove('show'), 3000); }

Â  Â  // AutentifikÃ¡cia
Â  Â  window.login = async () => { if (!isOnline()) return showErrorNotification('Ste offline.'); const e = document.getElementById('email').value, p = document.getElementById('password').value; if (!e || !p) return showErrorNotification('Zadajte email a heslo.'); try { await signInWithEmailAndPassword(auth, e, p); } catch (err) { showErrorNotification(`Chyba prihlÃ¡senia: ${mapFirebaseAuthError(err.code)}`); } };
Â  Â  window.register = async () => { if (!isOnline()) return showErrorNotification('Ste offline.'); const e = document.getElementById('email').value, p = document.getElementById('password').value; if (!e || !p) return showErrorNotification('Zadajte email a heslo.'); if (p.length < 6) return showErrorNotification('Heslo min. 6 znakov.'); try { await createUserWithEmailAndPassword(auth, e, p); await createUserCollection(); } catch (err) { showErrorNotification(`Chyba registrÃ¡cie: ${mapFirebaseAuthError(err.code)}`); } };
Â  Â  window.logout = async () => { try { await signOut(auth); monthData = {}; } catch (err) { showErrorNotification(`Chyba odhlÃ¡senia: ${err.message}`); } };
Â  Â  window.resetPassword = async () => { if (!isOnline()) return showErrorNotification('Ste offline.'); const eInput = document.getElementById('email'), email = eInput.value; if (!email) { eInput.style.border = '1px solid red'; setTimeout(() => { eInput.style.border = '1px solid #ccc'; }, 3000); return showErrorNotification('Zadajte email.'); } eInput.style.border = '1px solid #ccc'; try { await sendPasswordResetEmail(auth, email); showSaveNotification(`Email na obnovu odoslanÃ½ na ${email}.`); } catch (err) { showErrorNotification(`Chyba obnovy: ${mapFirebaseAuthError(err.code)}`); } };
Â  Â  function mapFirebaseAuthError(code) { const map = {'auth/invalid-email':'NeplatnÃ½ email.','auth/user-not-found':'PouÅ¾Ã­vateÄ¾ nenÃ¡jdenÃ½.','auth/wrong-password':'NesprÃ¡vne heslo.','auth/email-already-in-use':'Email uÅ¾ existuje.','auth/weak-password':'SlabÃ© heslo.','auth/requires-recent-login':'VyÅ¾aduje sa novÃ© prihlÃ¡senie.','auth/network-request-failed':'Chyba siete.','auth/missing-email':'Zadajte email.'}; return map[code] || code; }
Â  Â  async function createUserCollection() { if (!auth.currentUser) return; const uRef = doc(db, 'users', auth.currentUser.uid); try { await setDoc(uRef, { email: auth.currentUser.email, createdAt: new Date() }, { merge: true }); const iRef = doc(collection(uRef, 'workDays'), 'initial_setup'); await setDoc(iRef, { setupComplete: true }); } catch (err) { console.error('Chyba vytvorenia user kolekcie:', err); } }

Â  Â  // UI Update a NaÄÃ­tanie dÃ¡t
Â  Â  function updateUI() { const lForm = document.getElementById('login-form'), uInfo = document.getElementById('user-info'), uEmail = document.getElementById('user-email'); createTable(); if (currentUser) { lForm.style.display = 'none'; uInfo.style.display = 'block'; uEmail.textContent = currentUser.email; loadInitialData(); } else { lForm.style.display = 'flex'; uInfo.style.display = 'none'; loadFromLocalStorageOnly(); if (!isOnline()) showErrorNotification('Ste offline.'); } updateGreeting(); /* ZabezpeÄÃ­ aktuÃ¡lny pozdrav aj pri zmene stavu prihlÃ¡senia */ }
Â  Â  async function loadInitialData() { const lKey = `workData-${currentYear}-${currentMonth}`, localData = localStorage.getItem(lKey), pKey = `pendingSync-${currentYear}-${currentMonth}`, pData = localStorage.getItem(pKey); if (pData && isOnline() && currentUser) { await syncWithFirebase(); const uData = localStorage.getItem(lKey); if (uData) parseAndApplyData(uData); else await loadFromFirestoreAndApply(); } else if (localData) parseAndApplyData(localData); else if (isOnline() && currentUser) await loadFromFirestoreAndApply(); else calculateTotal(); }
Â  Â  async function loadFromFirestoreAndApply() { if (!currentUser) return; try { const dRef = doc(db, 'users', currentUser.uid, 'workDays', `${currentYear}-${currentMonth}`); const dSnap = await getDoc(dRef); if (dSnap.exists()) { const sData = dSnap.data(), dataStr = JSON.stringify(sData); localStorage.setItem(`workData-${currentYear}-${currentMonth}`, dataStr); parseAndApplyData(dataStr); } else calculateTotal(); } catch (err) { showErrorNotification(`Chyba naÄÃ­tania z Firebase: ${err.message}`); calculateTotal(); } }
Â  Â  function loadFromLocalStorageOnly() { const lKey = `workData-${currentYear}-${currentMonth}`, lData = localStorage.getItem(lKey); if (lData) parseAndApplyData(lData); else calculateTotal(); }
Â  Â  function parseAndApplyData(dataString) { try { const sData = JSON.parse(dataString); hourlyWage = sData.hourlyWage ?? hourlyWage; taxRate = sData.taxRate ?? taxRate; employeeName = sData.employeeName ?? employeeName; decimalPlaces = sData.decimalPlaces ?? decimalPlaces; hourlyWageInput.value = hourlyWage; taxRateInput.value = (taxRate * 100).toFixed(1); employeeNameInput.value = employeeName; decimalPlacesSelect.value = decimalPlaces; updateGreeting(); localStorage.setItem('hourlyWage', hourlyWage); localStorage.setItem('taxRatePercent', (taxRate * 100).toFixed(1)); localStorage.setItem('employeeName', employeeName); localStorage.setItem('decimalPlaces', decimalPlaces); if (sData.data?.length) { const dInM = getDaysInMonth(currentMonth), dToP = Math.min(dInM, sData.data.length); for (let i = 0; i < dToP; i++) { const day = sData.data[i], idx = i + 1; const sEl = document.getElementById(`start-${currentYear}-${currentMonth}-${idx}`), eEl = document.getElementById(`end-${currentYear}-${currentMonth}-${idx}`), bEl = document.getElementById(`break-${currentYear}-${currentMonth}-${idx}`); if (sEl && eEl && bEl) { sEl.value = day.start || ''; eEl.value = day.end || ''; bEl.value = day.breakTime || ''; calculateRow(idx); } } for (let i = dToP + 1; i <= dInM; i++) if (document.getElementById(`start-${currentYear}-${currentMonth}-${i}`)) resetRow(i, false); } else { const dInM = getDaysInMonth(currentMonth); for (let i = 1; i <= dInM; i++) if (document.getElementById(`start-${currentYear}-${currentMonth}-${i}`)) resetRow(i, false); } calculateTotal(); } catch (err) { showErrorNotification(`Chyba spracovania dÃ¡t: ${err.message}`); const dInM = getDaysInMonth(currentMonth); for (let i = 1; i <= dInM; i++) if (document.getElementById(`start-${currentYear}-${currentMonth}-${i}`)) resetRow(i, false); calculateTotal(); } }

Â  Â  // Ukladanie dÃ¡t
Â  Â  function debounce(func, wait) { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => func(...a), wait); }; }
Â  Â  const debouncedSaveToFirestore = debounce(saveToFirestore, 1000);
Â  Â  function collectCurrentData() { const sData = { data: [], hourlyWage, taxRate, employeeName, decimalPlaces, lastUpdated: new Date().toISOString() }; const dInM = getDaysInMonth(currentMonth); for (let i = 1; i <= dInM; i++) { const s = document.getElementById(`start-${currentYear}-${currentMonth}-${i}`)?.value || '', e = document.getElementById(`end-${currentYear}-${currentMonth}-${i}`)?.value || '', b = document.getElementById(`break-${currentYear}-${currentMonth}-${i}`)?.value || '', g = document.getElementById(`gross-${currentYear}-${currentMonth}-${i}`)?.value || '0', n = document.getElementById(`net-${currentYear}-${currentMonth}-${i}`)?.value || '0'; sData.data.push({ start: s, end: e, breakTime: b, gross: g, net: n }); } return sData; }
Â  Â  async function saveToFirestore() { if (!currentUser) return; const sData = collectCurrentData(), pKey = `pendingSync-${currentYear}-${currentMonth}`; if (isOnline()) { try { const dRef = doc(db, 'users', currentUser.uid, 'workDays', `${currentYear}-${currentMonth}`); await setDoc(dRef, sData, { merge: true }); localStorage.removeItem(pKey); showSaveNotification('DÃ¡ta synchronizovanÃ©.'); } catch (err) { showErrorNotification(`Chyba ukladania do cloudu: ${err.message}`); localStorage.setItem(pKey, JSON.stringify(sData)); } } else { localStorage.setItem(pKey, JSON.stringify(sData)); showSaveNotification('Offline, uloÅ¾enÃ© lokÃ¡lne.'); } }
Â  Â  async function syncWithFirebase() { if (!currentUser || !isOnline()) return; const pKey = `pendingSync-${currentYear}-${currentMonth}`, pDataStr = localStorage.getItem(pKey); if (pDataStr) { try { const dSync = JSON.parse(pDataStr), dRef = doc(db, 'users', currentUser.uid, 'workDays', `${currentYear}-${currentMonth}`); await setDoc(dRef, dSync, { merge: true }); localStorage.setItem(`workData-${currentYear}-${currentMonth}`, pDataStr); localStorage.removeItem(pKey); showSaveNotification('Offline dÃ¡ta synchronizovanÃ©.'); parseAndApplyData(pDataStr); } catch (err) { showErrorNotification(`Chyba synchronizÃ¡cie: ${err.message}`); } } }

Â  Â  // NaÄÃ­tanie z Firebase tlaÄidlom
Â  Â  window.loadFromFirestore = async () => { if (!currentUser) return showErrorNotification('PrihlÃ¡ste sa.'); if (!isOnline()) return showErrorNotification('Ste offline.'); if (!confirm('PrepÃ­saÅ¥ lokÃ¡lne dÃ¡ta?')) return; try { const dRef = doc(db, 'users', currentUser.uid, 'workDays', `${currentYear}-${currentMonth}`); const dSnap = await getDoc(dRef); if (dSnap.exists()) { const sData = dSnap.data(), dStr = JSON.stringify(sData); localStorage.setItem(`workData-${currentYear}-${currentMonth}`, dStr); localStorage.removeItem(`pendingSync-${currentYear}-${currentMonth}`); parseAndApplyData(dStr); showSaveNotification('DÃ¡ta naÄÃ­tanÃ© z Firebase.'); } else showErrorNotification('Å½iadne dÃ¡ta vo Firebase.'); } catch (err) { showErrorNotification(`Chyba naÄÃ­tania z Firebase: ${err.message}`); } };

Â  Â  // Vytvorenie tabuÄ¾ky a vÃ½poÄty
Â  Â  function getDayName(y, m, d) { return new Date(y, m, d).toLocaleDateString('sk-SK', { weekday: 'short' }); }
Â  Â  window.insertCurrentTime = (inputId) => { const iEl = document.getElementById(inputId); if (iEl) { const now = new Date(), h = String(now.getHours()).padStart(2, '0'), m = String(now.getMinutes()).padStart(2, '0'); iEl.value = `${h}:${m}`; handleInput(iEl, ''); } };
Â  Â  function createTable() { const dInM = getDaysInMonth(currentMonth); workDays.innerHTML = ''; const today = new Date(), tDate = today.getDate(), tMon = today.getMonth(), tYear = today.getFullYear(); if (isNaN(dInM) || dInM <= 0) return console.error("NeplatnÃ½ poÄet dnÃ­:", dInM); for (let i = 1; i <= dInM; i++) { const row = document.createElement('tr'); if (i === tDate && currentMonth === tMon && currentYear === tYear) row.classList.add('current-day'); const dName = getDayName(currentYear, currentMonth, i), sId = `start-${currentYear}-${currentMonth}-${i}`, eId = `end-${currentYear}-${currentMonth}-${i}`, bId = `break-${currentYear}-${currentMonth}-${i}`, totId = `total-${currentYear}-${currentMonth}-${i}`, gId = `gross-${currentYear}-${currentMonth}-${i}`, nId = `net-${currentYear}-${currentMonth}-${i}`; row.innerHTML = `<td>${i}. ${dName}</td><td><div class="time-input-wrapper"><input type="tel" id="${sId}" maxlength="5" pattern="[0-9:]*" inputmode="numeric" placeholder="HH:MM" oninput="handleInput(this, '${eId}')"><span class="clock-icon" onclick="insertCurrentTime('${sId}')" title="VloÅ¾iÅ¥ Äas">ğŸ•’</span></div></td><td><div class="time-input-wrapper"><input type="tel" id="${eId}" maxlength="5" pattern="[0-9:]*" inputmode="numeric" placeholder="HH:MM" oninput="handleInput(this, '${bId}')"><span class="clock-icon" onclick="insertCurrentTime('${eId}')" title="VloÅ¾iÅ¥ Äas">ğŸ•’</span></div></td><td><input type="number" id="${bId}" min="0" step="0.5" placeholder="hod." oninput="handleBreakInput(${i})"></td><td id="${totId}">0h 0m (${(0).toFixed(decimalPlaces)} h)</td><td><input type="number" id="${gId}" min="0" step="0.01" placeholder="0.00" readonly></td><td><input type="number" id="${nId}" min="0" step="0.01" placeholder="0.00" readonly></td><td><button class="btn reset-btn" onclick="resetRow(${i})">X</button></td>`; workDays.appendChild(row); } }
Â  Â  window.handleInput = (input, nextId) => { formatAndMoveNext(input, nextId); calculateAndUpdateTotals(); };
Â  Â  window.handleBreakInput = (day) => { const bIn = document.getElementById(`break-${currentYear}-${currentMonth}-${day}`); if (bIn) { let bVal = parseFloat(bIn.value); if (isNaN(bVal) || bVal < 0) bIn.value = ''; } calculateRow(day); calculateAndUpdateTotals(); };
Â  Â  function calculateAndUpdateTotals() { calculateTotal(); const sData = collectCurrentData(), lKey = `workData-${currentYear}-${currentMonth}`; localStorage.setItem(lKey, JSON.stringify(sData)); debouncedSaveToFirestore(); }
Â  Â  function isValidTimeFormat(tStr) { return /^([01]\d|2[0-3]):([0-5]\d)$/.test(tStr); }
Â  Â  function formatAndMoveNext(input, nextId) { let v = input.value.replace(/[^\d:]/g, ''), oV = input.value, cP = input.selectionStart; if (v.length === 2 && !v.includes(':') && v.length > oV.replace(/[^\d]/g, '').length) v += ':'; else if (v.length === 4 && !v.includes(':')) v = `${v.substring(0, 2)}:${v.substring(2)}`; else if (v.length === 3 && !v.includes(':') && v.length > oV.replace(/[^\d]/g, '').length) v = `${v.substring(0, 2)}:${v.substring(2)}`; v = v.replace(/^:/, ''); if ((v.match(/:/g) || []).length > 1) { const p = v.split(':'); v = `${p[0]}:${p.slice(1).join('')}`; } if (v.length > 5) v = v.slice(0, 5); if (input.value !== v) { input.value = v; try { if (v.length === 3 && oV.length === 2 && v.endsWith(':')) input.setSelectionRange(3, 3); else input.setSelectionRange(cP, cP); } catch (e) {} } const day = parseInt(input.id.split('-')[3]); if (v.length === 5) { calculateRow(day); if (isValidTimeFormat(v) && nextId) moveNext(input, nextId); } else calculateRow(day); }
Â  Â  function moveNext(currEl, nextId) { const nextEl = document.getElementById(nextId); if (nextEl) { nextEl.focus(); if (nextEl.tagName === 'INPUT' && nextEl.type !== 'number') nextEl.select(); } }
Â  Â  function calculateRow(day) { const sIn = document.getElementById(`start-${currentYear}-${currentMonth}-${day}`), eIn = document.getElementById(`end-${currentYear}-${currentMonth}-${day}`), bIn = document.getElementById(`break-${currentYear}-${currentMonth}-${day}`), tCell = document.getElementById(`total-${currentYear}-${currentMonth}-${day}`), gIn = document.getElementById(`gross-${currentYear}-${currentMonth}-${day}`), nIn = document.getElementById(`net-${currentYear}-${currentMonth}-${day}`); if (!sIn || !eIn || !bIn || !tCell || !gIn || !nIn) return; const sTime = sIn.value, eTime = eIn.value, bTime = parseFloat(bIn.value) || 0; if (!isValidTimeFormat(sTime) || !isValidTimeFormat(eTime)) { tCell.textContent = `0h 0m (${(0).toFixed(decimalPlaces)} h)`; gIn.value = (0).toFixed(decimalPlaces); nIn.value = (0).toFixed(decimalPlaces); return; } const [sH, sM] = sTime.split(':').map(Number), [eH, eM] = eTime.split(':').map(Number); const sDate = new Date(2000, 0, 1, sH, sM); let eDate = new Date(2000, 0, 1, eH, eM); if (eDate < sDate) eDate.setDate(eDate.getDate() + 1); let dMins = (eDate.getTime() - sDate.getTime()) / 60000 - (bTime * 60); if (dMins < 0) dMins = 0; const decHrs = dMins / 60, totMinsRnd = Math.round(dMins), hrs = Math.floor(totMinsRnd / 60), mins = totMinsRnd % 60; tCell.textContent = `${hrs}h ${mins}m (${decHrs.toFixed(decimalPlaces)} h)`; const gSal = Math.max(0, decHrs * hourlyWage); gIn.value = gSal.toFixed(decimalPlaces); updateNetSalary(day); }
Â  Â  function updateNetSalary(day) { const gIn = document.getElementById(`gross-${currentYear}-${currentMonth}-${day}`), nIn = document.getElementById(`net-${currentYear}-${currentMonth}-${day}`); if (!gIn || !nIn) return; const gSal = parseFloat(gIn.value) || 0, nSal = Math.max(0, gSal * (1 - taxRate)); nIn.value = nSal.toFixed(decimalPlaces); }
Â  Â  window.resetRow = (day, save = true) => { const s = document.getElementById(`start-${currentYear}-${currentMonth}-${day}`), e = document.getElementById(`end-${currentYear}-${currentMonth}-${day}`), b = document.getElementById(`break-${currentYear}-${currentMonth}-${day}`); if(s) s.value = ''; if(e) e.value = ''; if(b) b.value = ''; calculateRow(day); if (save) calculateAndUpdateTotals(); };
Â  Â  function calculateTotal() { let totMins = 0, totGross = 0, totNet = 0, dWE = 0; const dInM = getDaysInMonth(currentMonth); for (let i = 1; i <= dInM; i++) { const s = document.getElementById(`start-${currentYear}-${currentMonth}-${i}`)?.value, e = document.getElementById(`end-${currentYear}-${currentMonth}-${i}`)?.value, b = parseFloat(document.getElementById(`break-${currentYear}-${currentMonth}-${i}`)?.value) || 0; let dM = 0, dG = 0, dN = 0, hE = false; if (isValidTimeFormat(s) && isValidTimeFormat(e)) { const [sH, sM] = s.split(':').map(Number), [eH, eM] = e.split(':').map(Number); const sD = new Date(2000, 0, 1, sH, sM); let eD = new Date(2000, 0, 1, eH, eM); if (eD < sD) eD.setDate(eD.getDate() + 1); let diffM = (eD.getTime() - sD.getTime()) / 60000 - (b * 60); if (diffM < 0) diffM = 0; dM = diffM; const dH = dM / 60; dG = Math.max(0, dH * hourlyWage); dN = Math.max(0, dG * (1 - taxRate)); if (dM > 0) hE = true; } if (s || e || b > 0) hE = true; totMins += dM; totGross += dG; totNet += dN; if (hE) dWE++; } const totMRnd = Math.round(totMins), totH = Math.floor(totMRnd / 60), totMRem = totMRnd % 60, totDecH = totMins / 60, avgNet = dWE > 0 ? totNet / dWE : 0, avgMins = dWE > 0 ? totMins / dWE : 0, avgMRnd = Math.round(avgMins), avgH = Math.floor(avgMRnd / 60), avgM = avgMRnd % 60, avgDecH = avgMins / 60; totalSalaryDiv.innerHTML = `ZapoÄÃ­tanÃ½ch dnÃ­: ${dWE}<br>CelkovÃ½ Äas: ${totH}h ${totMRem}m (${totDecH.toFixed(decimalPlaces)} h)<br>HrubÃ¡ mzda: ${totGross.toFixed(decimalPlaces)} â‚¬<br>ÄŒistÃ¡ mzda: ${totNet.toFixed(decimalPlaces)} â‚¬<br>Priem. ÄistÃ¡ mzda/deÅˆ: ${avgNet.toFixed(decimalPlaces)} â‚¬<br><strong>Priem. Äas/deÅˆ: ${avgH}h ${avgM}m (${avgDecH.toFixed(decimalPlaces)} h)</strong>`; }

Â  Â  // Exporty a nastavenia
Â  Â  function getMonthName(m) { return new Date(2000, m, 1).toLocaleDateString('sk-SK', { month: 'long' }); }
Â  Â  window.exportToPDF = () => { const { jsPDF } = window.jspdf; const doc = new jsPDF(); doc.addFont('https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/fonts/Roboto/Roboto-Regular.ttf','Roboto','normal'); doc.setFont('Roboto'); doc.setFontSize(16); doc.text(`VÃ½kaz prÃ¡ce - ${getMonthName(currentMonth)} ${currentYear}`, 14, 22); doc.setFontSize(12); doc.text(`PracovnÃ­k: ${employeeName || 'NezadanÃ©'}`, 14, 30); const tData = []; const dInM = getDaysInMonth(currentMonth); for (let i = 1; i <= dInM; i++) { const sT = document.getElementById(`start-${currentYear}-${currentMonth}-${i}`)?.value||'', eT = document.getElementById(`end-${currentYear}-${currentMonth}-${i}`)?.value||'', bT = document.getElementById(`break-${currentYear}-${currentMonth}-${i}`)?.value||''; const totTCell = document.getElementById(`total-${currentYear}-${currentMonth}-${i}`), totT = totTCell?totTCell.textContent.trim():'', gS = document.getElementById(`gross-${currentYear}-${currentMonth}-${i}`)?.value||'0', nS = document.getElementById(`net-${currentYear}-${currentMonth}-${i}`)?.value||'0'; if (sT||eT||(bT&&parseFloat(bT)>0)) tData.push([`${i}. ${getDayName(currentYear, currentMonth, i)}`,sT,eT,bT||'0',totT,`${parseFloat(gS).toFixed(decimalPlaces)} â‚¬`,`${parseFloat(nS).toFixed(decimalPlaces)} â‚¬`]); } doc.autoTable({ head:[['DeÅˆ','PrÃ­chod','Odchod','PrestÃ¡vka (h)','OdpracovanÃ©','HrubÃ¡ Mzda','ÄŒistÃ¡ Mzda']], body:tData, startY:38, theme:'grid', styles:{font:'Roboto',fontSize:9,cellPadding:2,valign:'middle'}, headStyles:{fillColor:[220,220,220],textColor:[0,0,0],fontStyle:'bold',fontSize:10,halign:'center'}, alternateRowStyles:{fillColor:[245,245,245]}, columnStyles:{0:{cellWidth:25,halign:'left'},1:{cellWidth:18,halign:'center'},2:{cellWidth:18,halign:'center'},3:{cellWidth:22,halign:'center'},4:{cellWidth:35,halign:'center'},5:{cellWidth:27,halign:'right'},6:{cellWidth:27,halign:'right'}} }); const totY = doc.lastAutoTable.finalY + 10; doc.setFontSize(11); const totTxt = totalSalaryDiv.innerHTML.replace(/<br\s*\/?>/gi,'\n').replace(/<\/?strong>/gi,'').replace(/ /g,' ').replace(/â‚¬/g,' EUR'); doc.text(totTxt, 14, totY); const sName = (employeeName||'Nezadane').replace(/[^a-zA-Z0-9]/g,'_'); doc.save(`Vykaz_prace_${sName}_${getMonthName(currentMonth)}_${currentYear}.pdf`); };
Â  Â  window.sendPDF = () => { const { jsPDF } = window.jspdf; const doc = new jsPDF(); doc.addFont('https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/fonts/Roboto/Roboto-Regular.ttf','Roboto','normal'); doc.setFont('Roboto'); doc.setFontSize(16); doc.text(`ZÃ¡znam dochÃ¡dzky - ${getMonthName(currentMonth)} ${currentYear}`, 14, 22); doc.setFontSize(12); doc.text(`PracovnÃ­k: ${employeeName || 'NezadanÃ©'}`, 14, 30); const tData = []; const dInM = getDaysInMonth(currentMonth); for (let i = 1; i <= dInM; i++) { const sT = document.getElementById(`start-${currentYear}-${currentMonth}-${i}`)?.value||'', eT = document.getElementById(`end-${currentYear}-${currentMonth}-${i}`)?.value||'', bT = document.getElementById(`break-${currentYear}-${currentMonth}-${i}`)?.value||''; if (sT||eT||(bT&&parseFloat(bT)>0)) tData.push([`${i}. ${getDayName(currentYear, currentMonth, i)}`,sT,eT,bT||'0']); } doc.autoTable({ head:[['DeÅˆ','PrÃ­chod','Odchod','PrestÃ¡vka (h)']], body:tData, startY:38, theme:'grid', styles:{font:'Roboto',fontSize:10,cellPadding:3,valign:'middle'}, headStyles:{fillColor:[220,220,220],textColor:[0,0,0],fontStyle:'bold',fontSize:11,halign:'center'}, alternateRowStyles:{fillColor:[245,245,245]}, columnStyles:{0:{cellWidth:50,halign:'left'},1:{cellWidth:40,halign:'center'},2:{cellWidth:40,halign:'center'},3:{cellWidth:40,halign:'center'}} }); try { const pBlob = doc.output('blob'), sName = (employeeName||'Nezadane').replace(/[^a-zA-Z0-9]/g,'_'), pFName = `Dochadzka_${sName}_${getMonthName(currentMonth)}_${currentYear}.pdf`, pFile = new File([pBlob], pFName, {type:'application/pdf'}); if (navigator.canShare?.({files:[pFile]})) navigator.share({files:[pFile],title:`DochÃ¡dzka ${getMonthName(currentMonth)} ${currentYear}`,text:`ZÃ¡znam dochÃ¡dzky pre ${employeeName} za ${getMonthName(currentMonth)} ${currentYear}.`}).catch(err => { if(err.name !== 'AbortError') showErrorNotification(`Chyba zdieÄ¾ania: ${err.message}`); }); else { showErrorNotification('ZdieÄ¾anie sÃºborov nie je podporovanÃ©.'); doc.save(pFName); } } catch(err) { showErrorNotification(`Chyba prÃ­pravy PDF: ${err.message}`); } };
Â  Â  window.changeDecimalPlaces = () => { decimalPlaces = parseInt(decimalPlacesSelect.value); localStorage.setItem('decimalPlaces', decimalPlaces); for (let i = 1; i <= getDaysInMonth(currentMonth); i++) if(document.getElementById(`start-${currentYear}-${currentMonth}-${i}`)) calculateRow(i); calculateAndUpdateTotals(); };
Â  Â  window.updateEmployeeName = () => { employeeName = employeeNameInput.value.trim(); localStorage.setItem('employeeName', employeeName); updateGreeting(); calculateAndUpdateTotals(); };
Â  Â  window.updateSettings = () => { const nW = parseFloat(hourlyWageInput.value), nTP = parseFloat(taxRateInput.value); if (!isNaN(nW) && nW >= 0) hourlyWage = nW; else hourlyWageInput.value = hourlyWage; if (!isNaN(nTP) && nTP >= 0) taxRate = nTP / 100; else taxRateInput.value = (taxRate * 100).toFixed(1); localStorage.setItem('hourlyWage', hourlyWage); localStorage.setItem('taxRatePercent', (taxRate * 100).toFixed(1)); for (let i = 1; i <= getDaysInMonth(currentMonth); i++) if(document.getElementById(`start-${currentYear}-${currentMonth}-${i}`)) calculateRow(i); calculateAndUpdateTotals(); };
Â  Â  window.changeMonth = () => { currentMonth = parseInt(monthSelect.value); updateUI(); };
Â  Â  window.changeYear = () => { currentYear = parseInt(yearSelect.value); updateUI(); };
Â  Â  function getDaysInMonth(m) { return new Date(currentYear, m + 1, 0).getDate(); }

Â  Â  // ZÃ¡loha a Obnova
Â  Â  window.createBackup = () => { const k = `workData-${currentYear}-${currentMonth}`, dStr = localStorage.getItem(k); if (dStr) { try { const dObj = JSON.parse(dStr), ws_d = [["DeÅˆ","PrÃ­chod","Odchod","PrestÃ¡vka (h)","HrubÃ¡ Mzda (â‚¬)","ÄŒistÃ¡ Mzda (â‚¬)"]]; if (dObj.data?.length) { const dInM = getDaysInMonth(currentMonth), dExp = dObj.data.slice(0, dInM); dExp.forEach((r, idx) => { const dN = idx + 1; ws_d.push([`${dN}. ${getDayName(currentYear, currentMonth, dN)}`,r.start||"",r.end||"",r.breakTime||"",r.gross?parseFloat(r.gross):0,r.net?parseFloat(r.net):0]); }); } ws_d.push([],["Nastavenia:","Hodnota"],["HodinovÃ¡ mzda",dObj.hourlyWage],["DaÅˆovÃ© percento (%)",dObj.taxRate*100],["Meno pracovnÃ­ka",dObj.employeeName],["PoÄet desatinnÃ½ch miest",dObj.decimalPlaces],["PoslednÃ¡ aktualizÃ¡cia",dObj.lastUpdated?new Date(dObj.lastUpdated).toLocaleString('sk-SK'):"NeznÃ¡ma"]); const wb = XLSX.utils.book_new(), ws = XLSX.utils.aoa_to_sheet(ws_d); const mf = `0.00" â‚¬"`, tf = "hh:mm", bf = "0.0"; const dEndR = (dObj.data?.length||0)+1; for (let R=1; R<dEndR; ++R) { if(ws[XLSX.utils.encode_cell({c:1,r:R})]) ws[XLSX.utils.encode_cell({c:1,r:R})].z=tf; if(ws[XLSX.utils.encode_cell({c:2,r:R})]) ws[XLSX.utils.encode_cell({c:2,r:R})].z=tf; if(ws[XLSX.utils.encode_cell({c:3,r:R})]) ws[XLSX.utils.encode_cell({c:3,r:R})].z=bf; if(ws[XLSX.utils.encode_cell({c:4,r:R})]) ws[XLSX.utils.encode_cell({c:4,r:R})].z=mf; if(ws[XLSX.utils.encode_cell({c:5,r:R})]) ws[XLSX.utils.encode_cell({c:5,r:R})].z=mf; } ws['!cols'] = [{wch:12},{wch:8},{wch:8},{wch:10},{wch:14},{wch:14}]; const sRowIdx = ws_d.findIndex(r=>r[0]==="Nastavenia:"); if(sRowIdx!==-1) ws['!cols'][0].wch=25; XLSX.utils.book_append_sheet(wb, ws, `VÃ½kaz ${getMonthName(currentMonth)}`); const sName = (employeeName||'Nezadane').replace(/[^a-zA-Z0-9]/g,'_'); XLSX.writeFile(wb, `Zaloha_BrunoCalc_${sName}_${getMonthName(currentMonth)}_${currentYear}.xlsx`); showSaveNotification('ZÃ¡loha vytvorenÃ¡.'); } catch(err) { showErrorNotification(`Chyba zÃ¡lohy: ${err.message}`); } } else showErrorNotification('Å½iadne dÃ¡ta na zÃ¡lohu.'); };
Â  Â  window.restoreBackup = () => { const i = document.createElement('input'); i.type='file'; i.accept='.xlsx'; i.onchange = (ev) => { const f = ev.target.files[0]; if (!f) return; const r = new FileReader(); r.onload = (e) => { try { const d = new Uint8Array(e.target.result), wb = XLSX.read(d, {type:'array', cellDates:true, cellNF:true}), sName = wb.SheetNames[0], ws = wb.Sheets[sName], rows = XLSX.utils.sheet_to_json(ws, {header:1, defval:"", raw:false}); const hIdx = rows.findIndex(r => r?.[0]?.toString().toLowerCase().includes("deÅˆ")); if(hIdx===-1) throw new Error("HlaviÄka nenÃ¡jdenÃ¡."); const h = rows[hIdx], dIdx = h.findIndex(h=>h?.toLowerCase().includes("deÅˆ")), sIdx = h.findIndex(h=>h?.toLowerCase().includes("prÃ­chod")), eIdx = h.findIndex(h=>h?.toLowerCase().includes("odchod")), bIdx = h.findIndex(h=>h?.toLowerCase().includes("prestÃ¡vka")); if([dIdx,sIdx,eIdx,bIdx].includes(-1)) throw new Error("ChÃ½bajÃºce stÄºpce."); let dArr=[], sets={}, rowI = hIdx + 1; for (; rowI<rows.length; rowI++) { const row=rows[rowI]; if(!row||!row[dIdx]?.toString().match(/^\d+\.|^DeÅˆ/i)) break; let sT = row[sIdx]?.toString()||"", eT = row[eIdx]?.toString()||""; if(!isNaN(parseFloat(sT))&&parseFloat(sT)>=0&&parseFloat(sT)<=1&&!sT.includes(':')) sT=XLSX.SSF.format('hh:mm',parseFloat(sT)); if(!isNaN(parseFloat(eT))&&parseFloat(eT)>=0&&parseFloat(eT)<=1&&!eT.includes(':')) eT=XLSX.SSF.format('hh:mm',parseFloat(eT)); dArr.push({start:sT, end:eT, breakTime:row[bIdx]?.toString().replace(',','.')||"", gross:"0", net:"0"}); } for (; rowI<rows.length; rowI++) { const row=rows[rowI]; if (row?.length>1&&row[0]) { const k=row[0].toString().trim().toLowerCase(), v=row[1]?.toString().trim()||""; if(k.includes("hodinovÃ¡ mzda")) sets.hourlyWage=parseFloat(v.replace(',','.'))||undefined; else if(k.includes("daÅˆovÃ© percento")) sets.taxRate=(parseFloat(v.replace(',','.').replace('%',''))||undefined)/100; else if(k.includes("meno pracovnÃ­ka")) sets.employeeName=v||undefined; else if(k.includes("poÄet desatinnÃ½ch miest")) sets.decimalPlaces=parseInt(v)||undefined; } } const bData = {data:dArr, hourlyWage:sets.hourlyWage??hourlyWage, taxRate:sets.taxRate??taxRate, employeeName:sets.employeeName??employeeName, decimalPlaces:sets.decimalPlaces??decimalPlaces, lastUpdated:new Date().toISOString()}; if(!confirm(`ObnoviÅ¥ zÃ¡lohu (${dArr.length} dnÃ­)?`)) return; localStorage.setItem(`workData-${currentYear}-${currentMonth}`, JSON.stringify(bData)); parseAndApplyData(JSON.stringify(bData)); showSaveNotification('ZÃ¡loha obnovenÃ¡.'); if(currentUser&&isOnline()) saveToFirestore(); } catch(err) { showErrorNotification(`Chyba obnovy: ${err.message}`); } }; r.onerror=()=>showErrorNotification('Chyba ÄÃ­tania sÃºboru.'); r.readAsArrayBuffer(f); }; i.click(); };

Â  Â  // INIT
Â  Â  onAuthStateChanged(auth, (user) => { currentUser = user; updateUI(); });

Â  </script>

Â  Â  <script>
Â  Â  if ('serviceWorker' in navigator) {
Â  Â  Â  window.addEventListener('load', () => {
Â  Â  Â  Â  navigator.serviceWorker.register('./service-worker.js')
Â  Â  Â  Â  Â  .then(reg => console.log('SW reg:', reg.scope))
Â  Â  Â  Â  Â  .catch(err => console.error('SW reg err:', err));
Â  Â  Â  });
Â  Â  }
Â  </script>
</body>
</html>
